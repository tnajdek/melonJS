define(function(){function a(a){c||(b.utils.setNocache(document.location.href.match(/\?nocache/)||!1),b.audio.detectCapabilities(),b.sys.touch="createTouch"in document||"ontouchstart"in a||navigator.isCocoonJS,b.sys.isMobile=b.sys.ua.match(/Android|iPhone|iPad|iPod|BlackBerry|Windows Phone/i),b.timer.init(),b.mapReader=new b.TMXMapReader,b.loadingScreen=new b.DefaultLoadingScreen,b.state.init(),b.entityPool.init(),b.levelDirector.reset(),c=!0)}/**
 * @license MelonJS Game Engine
 * @copyright (C) 2011 - 2013 Olivier Biot, Jason Oster
 * http://www.melonjs.org
 *
 * melonJS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
var b=b||{},c=!1;return function(a){function d(){}a.document,b={mod:"melonJS",version:"@VERSION",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,TMXParser:null,loadingScreen:null,TMXTileMap:null},b.sys={ua:navigator.userAgent,sound:!1,localStorage:"object"==typeof a.localStorage,gyro:void 0!==a.DeviceMotionEvent,nativeBase64:"function"==typeof a.atob,touch:!1,isMobile:!1,fps:60,interpolation:!1,scale:null,scalingInterpolation:!1,gravity:void 0,useNativeAnimFrame:!1,cacheImage:!1,dirtyRegion:!1,stopOnAudioError:!0,pauseOnBlur:!0,preRender:!1,checkVersion:function(a,c){c=c||b.version;for(var d=a.split("."),e=c.split("."),f=Math.min(d.length,e.length),g=0,h=0;f>h&&!(g=+d[h]-+e[h]);h++);return g?g:d.length-e.length}};var e=!1,f=/var xyz/.test(function(){})?/\bparent\b/:/[\D|\d]*/;Object.extend=function(a){function b(){!e&&this.init&&this.init.apply(this,arguments)}var c=this.prototype;e=!0;var d=new this;e=!1;for(var g in a)d[g]="function"==typeof a[g]&&"function"==typeof c[g]&&f.test(a[g])?function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);return this.parent=d,e}}(g,a[g]):a[g];return b.prototype=d,b.constructor=b,b.extend=Object.extend,b},"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),e=function(){if(this instanceof e){var d=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(d)===d?d:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return b.prototype&&(d.prototype=b.prototype,e.prototype=new d,d.prototype=null),e}),"undefined"==typeof Date.now&&(Date.now=function(){return(new Date).getTime()}),"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}}),Function.prototype.defer=function(){var a=this,b=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return a.apply(a,b)},.01)},Object.defineProperty||(Object.defineProperty=function(a,b,c){if(!a.__defineGetter__)throw"melonJS: Object.defineProperty not supported";c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.isNumeric=function(){return null!==this&&!isNaN(this)&&""!==this.trim()},String.prototype.isBoolean=function(){return null!==this&&("true"===this.trim()||"false"===this.trim())},String.prototype.contains=function(a){return this.indexOf(a)>-1},String.prototype.toHex=function(){for(var a="",b=0;b<this.length;)a+=this.charCodeAt(b++).toString(16);return a},Number.prototype.clamp=function(a,b){return a>this?a:this>b?b:+this},Number.prototype.random=function(a,b){return~~(Math.random()*(b-a+1))+a},Number.prototype.round=function(){var a=arguments.length<2?this:arguments[0],b=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(a*b)/b},Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+"0123456789ABCDEF".charAt(this%16)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI},Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)},Array.prototype.remove=function(a){var b=Array.prototype.indexOf.call(this,a);return-1!==b&&Array.prototype.splice.call(this,b,1),this},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d--;c++)a.call(b||this,this[c],c,this)}),Object.defineProperty(b,"initialized",{get:function(){return c}});var g=function(){var a,c={},d=[],e=[],f=0;return c.isDirty=!1,c.reset=function(){d.length=0,e.length=0,a=b.game.viewport.getRect(),c.makeAllDirty()},c.makeDirty=function(a,f,g){f&&(c.isDirty=!0,b.sys.dirtyRegion&&(g?d.push(g.union(a)):a.getRect&&d.push(a.getRect()))),a.inViewport&&e.unshift(a)},c.makeAllDirty=function(){d.length=0,d.push(a),c.isDirty=!0},c.remove=function(a){var b=e.indexOf(a);-1!==b&&(e.splice(b,1),a.inViewport=!1,c.makeDirty(a,!0))},c.getDrawCount=function(){return f},c.draw=function(a){var c=b.game.viewport.pos.x+~~b.game.viewport.offset.x,g=b.game.viewport.pos.y+~~b.game.viewport.offset.y;a.save(),a.translate(-c,-g),c-=b.game.currentLevel.pos.x,g-=b.game.currentLevel.pos.y;for(var h,i=d.length;i--,h=d[i];){for(var j,k=e.length;k--,j=e[k];)b.sys.dirtyRegion&&j.isSprite&&!j.overlaps(h)||(j.floating===!0&&(a.save(),a.translate(c,g)),j.draw(a,h),j.floating===!0&&a.restore(),f++);b.debug.renderDirty&&h.draw(a,"white")}a.restore()},c.flush=function(){b.sys.dirtyRegion&&(d.length=0),e.length=0,c.isDirty=!1,f=0},c}();b.game=function(){var a={},c=null,d=[],e=!1,f=null,h=null,i=function(a,b){return b.z-a.z};return a.viewport=null,a.HUD=null,a.collisionMap=null,a.currentLevel=null,a.renderer=null,a.NO_OBJECT=0,a.ENEMY_OBJECT=1,a.COLLECTABLE_OBJECT=2,a.ACTION_OBJECT=3,a.onLevelLoaded=null,a.init=function(d,f){if(!e){var d=d||b.video.getWidth(),f=f||b.video.getHeight();a.viewport=new b.Viewport(0,0,d,f),c=b.video.getSystemContext(),b.event.publish(b.event.GAME_INIT),e=!0}},a.reset=function(){e||a.init(),a.removeAll(!0),a.viewport&&a.viewport.reset(),g.reset(),c.setTransform(1,0,0,1,0,0),a.currentLevel={pos:{x:0,y:0}}},a.loadTMXLevel=function(d){a.currentLevel=d,a.collisionMap=a.currentLevel.getLayerByName("collision"),a.collisionMap&&a.collisionMap.isCollisionMap||console.error("WARNING : no collision map detected");for(var e=a.currentLevel.getLayers(),f=e.length;f--;)e[f].visible&&a.add(e[f]);a.viewport.setBounds(Math.max(a.currentLevel.width,a.viewport.width),Math.max(a.currentLevel.height,a.viewport.height));for(var g=a.currentLevel.getObjectGroups(),h=0;h<g.length;h++)if(g[h].visible)for(var i=0;i<g[h].objects.length;i++)a.addEntity(g[h].objects[i],g[h].z);a.currentLevel.pos.x!==a.currentLevel.pos.y&&c.translate(a.currentLevel.pos.x,a.currentLevel.pos.y),a.sort(),a.onLevelLoaded&&a.onLevelLoaded.call(a.onLevelLoaded,d.name),b.event.publish(b.event.LEVEL_LOADED,[d.name])},a.add=function(a,b){a.z=b?b:a.z,d.push(a)},a.addEntity=function(c,d){var e=b.entityPool.newInstanceOf(c.name,c.x,c.y,c);e&&a.add(e,d)},a.getEntityByName=function(a){var b=[];a=a.toLowerCase();for(var c,e=d.length;e--,c=d[e];)c.name&&c.name.toLowerCase()===a&&b.push(c);return b},a.getObjectCount=function(){return d.length},a.getDrawCount=function(){return g.getDrawCount()},a.getEntityByGUID=function(a){for(var b,c=d.length;c--,b=d[c];)if(b.isEntity&&b.GUID==a)return b;return null},a.getEntityByProp=function(a,b){for(var c,e=[],f=d.length;f--,c=d[f];)c.isEntity&&c[a]==b&&e.push(c);return e},a.addHUD=function(c,d,e,f,g){null==a.HUD&&(a.HUD=new b.HUD_Object(c,d,e,f,g),a.add(a.HUD))},a.disableHUD=function(){null!=a.HUD&&(a.remove(a.HUD),a.HUD=null)},a.update=function(){for(var c,e=null,f=d.length;f--,c=d[f];){e=b.sys.dirtyRegion&&c.isSprite?c.getRect():null,c.inViewport=c.visible&&(c.floating||c.getRect&&a.viewport.isVisible(c));var h=(c.inViewport||c.alwaysUpdate)&&c.update();g.makeDirty(c,h,h?e:null)}a.viewport.update(g.isDirty)&&g.makeAllDirty()},a.remove=function(a,c){function e(a){a.destroy&&a.destroy(),g.remove(a),d.remove(a),b.entityPool.freeInstance(a)}d.indexOf(a)>-1&&(c===!0?e(a):(a.visible=!1,f=function(a){e(a),f=null}.defer(a)))},a.removeAll=function(b){f&&(clearTimeout(f),f=null),h&&(clearTimeout(h),h=null);for(var c=d.length;c--;)d[c].isPersistent||a.remove(d[c],b);b===!0&&g.flush()},a.sort=function(a){null===h&&("function"!=typeof a&&(a=i),h=function(a){d.sort(a),h=null,b.game.repaint()}.defer(a))},a.collide=function(a,b){var c;if(b=b===!0?!0:!1,b===!0)var e=[],f=0;for(var g,h=d.length;h--,g=d[h];)if((g.inViewport||g.alwaysUpdate)&&g.collidable&&g!=a&&(c=g.collisionBox.collideVsAABB.call(g.collisionBox,a.collisionBox),0!=c.x||0!=c.y)){if(g.onCollision.call(g,c,a),c.type=g.type,c.obj=g,!b)return c;e[f++]=c}return b?e:null},a.collideType=function(a,b,c){var e;if(c=c===!0?!0:!1,c===!0)var f=[],g=0;for(var h,i=d.length;i--,h=d[i];)if((h.inViewport||h.alwaysUpdate)&&h.collidable&&h.type===b&&h!=a&&(e=h.collisionBox.collideVsAABB.call(h.collisionBox,a.collisionBox),0!=e.x||0!=e.y)){if(h.onCollision.call(h,e,a),e.type=h.type,e.obj=h,!c)return e;f[g++]=e}return c?f:null},a.repaint=function(){g.makeAllDirty()},a.draw=function(){g.isDirty&&(g.draw(c),a.viewport.draw(c)),g.flush()},a}()}(window),function(){b.Vector2d=Object.extend({x:0,y:0,init:function(a,b){this.x=a||0,this.y=b||0},set:function(a,b){return this.x=a,this.y=b,this},setZero:function(){return this.set(0,0)},setV:function(a){return this.x=a.x,this.y=a.y,this},add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},scale:function(a){return this.x*=a.x,this.y*=a.y,this},div:function(a){return this.x/=a,this.y/=a,this},abs:function(){return this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y),this},clamp:function(a,c){return new b.Vector2d(this.x.clamp(a,c),this.y.clamp(a,c))},clampSelf:function(a,b){return this.x=this.x.clamp(a,b),this.y=this.y.clamp(a,b),this},minV:function(a){return this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y,this},maxV:function(a){return this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y,this},floor:function(){return new b.Vector2d(~~this.x,~~this.y)},floorSelf:function(){return this.x=~~this.x,this.y=~~this.y,this},ceil:function(){return new b.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},negate:function(){return new b.Vector2d(-this.x,-this.y)},negateSelf:function(){return this.x=-this.x,this.y=-this.y,this},copy:function(a){return this.x=a.x,this.y=a.y,this},equals:function(a){return this.x===a.x&&this.y===a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.length();if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},dotProduct:function(a){return this.x*a.x+this.y*a.y},distance:function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},clone:function(){return new b.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+",y:"+this.y}}),b.Rect=Object.extend({pos:null,colPos:null,anchorPoint:null,width:0,height:0,hWidth:0,hHeight:0,init:function(a,c,d){this.pos=a,this.colPos=new b.Vector2d,this.width=c,this.height=d,this.hWidth=~~(c/2),this.hHeight=~~(d/2),this.anchorPoint=new b.Vector2d(.5,.5),Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0}),Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(a,b,c){this.pos=a,this.width=b,this.height=c,this.hWidth=~~(b/2),this.hHeight=~~(c/2)},getRect:function(){return new b.Rect(this.pos.clone(),this.width,this.height)},translate:function(a,b){return this.pos.x+=a,this.pos.y+=b,this},translateV:function(a){return this.pos.add(a),this},union:function(a){var b=Math.min(this.pos.x,a.pos.x),c=Math.min(this.pos.y,a.pos.y);return this.width=Math.ceil(Math.max(this.pos.x+this.width,a.pos.x+a.width)-b),this.height=Math.ceil(Math.max(this.pos.y+this.height,a.pos.y+a.height)-c),this.pos.x=~~b,this.pos.y=~~c,this},adjustSize:function(a,b,c,d){-1!=a&&(this.colPos.x=a,this.width=b,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0})),-1!=c&&(this.colPos.y=c,this.height=d,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(a){this.colPos.x=a-this.width-this.colPos.x,this.hWidth=~~(this.width/2)},flipY:function(a){this.colPos.y=a-this.height-this.colPos.y,this.hHeight=~~(this.height/2)},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a){return a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom},collideVsAABB:function(a){var c=new b.Vector2d(0,0);if(this.overlaps(a)){var d=this.left+this.hWidth-a.left-a.hWidth,e=this.top+this.hHeight-a.top-a.hHeight;c.x=a.hWidth+this.hWidth-(0>d?-d:d),c.y=a.hHeight+this.hHeight-(0>e?-e:e),c.x<c.y?(c.y=0,c.x=0>d?-c.x:c.x):(c.x=0,c.y=0>e?-c.y:c.y)}return c},draw:function(a,b){a.strokeStyle=b||"red",a.strokeRect(this.left,this.top,this.width,this.height)}})}(window),function(){b.debug={displayFPS:!1,renderHitBox:!1,renderCollisionMap:!1,renderDirty:!1,renderVelocity:!1}}(window),function(){b.Renderable=b.Rect.extend({isRenderable:!0,visible:!0,inViewport:!1,alwaysUpdate:!1,isPersistent:!1,floating:!1,init:function(a,b,c){this.parent(a,b,c)},update:function(){return!1},draw:function(a,b){this.parent(a,b)}})}(window),function(){b.SpriteObject=b.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,angle:0,_sourceAngle:0,alpha:1,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(a,c,d,e,f){this.isSprite=!0,this.parent(new b.Vector2d(a,c),e||d.width,f||d.height),this.image=d,this.scale=new b.Vector2d(1,1),this.lastflipX=this.lastflipY=!1,this.scaleFlag=!1,this.offset=new b.Vector2d(0,0),this.alpha=1,this.visible=!0,this.isPersistent=!1,this.flickering=!1},setTransparency:function(a){a="#"==a.charAt(0)?a.substring(1,7):a,this.image=b.video.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,b){this.flickerTimer=a,this.flickerTimer<0?(this.flickering=!1,this.flickercb=null):this.flickering||(this.flickercb=b,this.flickering=!0)},flipX:function(a){a!=this.lastflipX&&(this.lastflipX=a,this.scale.x=-this.scale.x,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},flipY:function(a){a!=this.lastflipY&&(this.lastflipY=a,this.scale.y=-this.scale.y,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},resize:function(a){a>0&&(this.scale.x=this.scale.x<0?-a:a,this.scale.y=this.scale.y<0?-a:a,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},getOpacity:function(){return this.alpha},setOpacity:function(a){"number"==typeof a&&(this.alpha=a.clamp(0,1))},update:function(){return this.flickering?(this.flickerTimer-=b.timer.tick,this.flickerTimer<0&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(!this.flickering||(this.flickerState=!this.flickerState,this.flickerState)){a.save(),a.globalAlpha=this.alpha;var c=~~this.pos.x,d=~~this.pos.y,e=this.width,f=this.height,g=this.angle+this._sourceAngle;if(this.scaleFlag||0!==g){var h=e*this.anchorPoint.x,i=f*this.anchorPoint.y;a.translate(c+h,d+i),this.scaleFlag&&a.scale(this.scale.x,this.scale.y),0!==g&&a.rotate(g),0!==this._sourceAngle?(e=this.height,f=this.width,c=-i,d=-h):(c=-h,d=-i)}a.drawImage(this.image,this.offset.x,this.offset.y,e,f,c,d,e,f),a.restore(),b.debug.renderHitBox&&this.parent(a,"green")}},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}}),b.AnimationSheet=b.SpriteObject.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,animationspeed:0,init:function(a,c,d,e,f,g,h,i,j){this.anim=[],this.resetAnim=null,this.current=null,this.animationspeed=b.sys.fps/10,this.spacing=g||0,this.margin=h||0,this.parent(a,c,d,e,f,g,h),this.textureAtlas=null,this.atlasIndices=null,this.buildLocalAtlas(i||void 0,j||void 0),this.addAnimation("default",null),this.setCurrentAnimation("default")},buildLocalAtlas:function(a,c){if(void 0!==a)this.textureAtlas=a,this.atlasIndices=c;else{this.textureAtlas=[];for(var d=new b.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing))),e=0,f=d.x*d.y;f>e;e++)this.textureAtlas[e]={name:""+e,offset:new b.Vector2d(this.margin+(this.spacing+this.width)*(e%d.x),this.margin+(this.spacing+this.height)*~~(e/d.x)),width:this.width,height:this.height,angle:0}}},addAnimation:function(a,b,c){if(this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:c||this.animationspeed},null==b){b=[];var d=0;this.textureAtlas.forEach(function(){b[d]=d++})}for(var d=0,e=b.length;e>d;d++)if("number"==typeof b[d])this.anim[a].frame[d]=this.textureAtlas[b[d]];else{if(null===this.atlasIndices)throw"melonjs: string parameters for addAnimation are only allowed for TextureAtlas ";this.anim[a].frame[d]=this.textureAtlas[this.atlasIndices[b[d]]]}this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,b){if(!this.anim[a])throw"melonJS: animation id '"+a+"' not defined";this.current=this.anim[a],this.resetAnim=b||null,this.setAnimationFrame(this.current.idx)},isCurrentAnimation:function(a){return this.current.name==a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;var b=this.current.frame[this.current.idx];this.offset=b.offset,this.width=b.width,this.height=b.height,this._sourceAngle=b.angle},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){return!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.setAnimationFrame(++this.current.idx),this.fpscount=0,0==this.current.idx&&this.resetAnim&&("string"==typeof this.resetAnim?this.setCurrentAnimation(this.resetAnim):"function"==typeof this.resetAnim&&this.resetAnim()),this.parent()||!0):this.parent()}})}(window),function(){var a=-(Math.PI/2);b.TextureAtlas=Object.extend({format:null,texture:null,atlas:null,init:function(a,c){if(a&&a.meta&&a.meta.app.contains("texturepacker")){if(this.format="texturepacker",void 0===c){var d=b.utils.getBasename(a.meta.image);if(this.texture=b.loader.getImage(d),null===this.texture)throw"melonjs: Atlas texture '"+d+"' not found"}else this.texture=c;this.atlas=this.initFromTexturePacker(a)}if(null===this.atlas)throw"melonjs: texture atlas format not supported"},initFromTexturePacker:function(a){var c={};return a.frames.forEach(function(a){c[a.filename]={frame:new b.Rect(new b.Vector2d(a.frame.x,a.frame.y),a.frame.w,a.frame.h),source:new b.Rect(new b.Vector2d(a.spriteSourceSize.x,a.spriteSourceSize.y),a.spriteSourceSize.w,a.spriteSourceSize.h),rotated:a.rotated===!0,trimmed:a.trimmed===!0}}),c},getTexture:function(){return this.texture},getRegion:function(b){var c=this.atlas[b];return c?{name:b,pos:c.source.pos.clone(),offset:c.frame.pos.clone(),width:c.frame.width,height:c.frame.height,angle:c.rotated===!0?a:0}:null},createSpriteFromName:function(a){var c=this.getRegion(a);if(c){var d=new b.SpriteObject(0,0,this.getTexture(),c.width,c.height);return d.offset.setV(c.offset),d._sourceAngle=c.angle,d}throw"melonjs: TextureAtlas - region for "+a+" not found"},createAnimationFromName:function(a){for(var c=[],d={},e=0;e<a.length;++e)if(c[e]=this.getRegion(a[e]),d[a[e]]=e,null==c[e])throw"melonjs: TextureAtlas - region for "+a[e]+" not found";return new b.AnimationSheet(0,0,this.texture,0,0,0,0,c,d)}})}(window),function(){var a=Math.min,c=Math.max;b.Viewport=b.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,shaking:!1,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(a,c,d,e,f,g){this.parent(new b.Vector2d(a,c),d-a,e-c),this.limits=new b.Vector2d(f||this.width,g||this.height),this.offset=new b.Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null,start:0},this._fadeOut={color:0,alpha:0,duration:0,tween:null},this._fadeIn={color:0,alpha:1,duration:0,tween:null},this.setDeadzone(this.width/6,this.height/6)},_followH:function(b){return b.x-this.pos.x>this._deadwidth?(this.pos.x=~~a(b.x-this._deadwidth,this._limitwidth),!0):b.x-this.pos.x<this.deadzone.x?(this.pos.x=~~c(b.x-this.deadzone.x,0),!0):!1},_followV:function(b){return b.y-this.pos.y>this._deadheight?(this.pos.y=~~a(b.y-this._deadheight,this._limitheight),!0):b.y-this.pos.y<this.deadzone.y?(this.pos.y=~~c(b.y-this.deadzone.y,0),!0):!1},reset:function(a,b){this.pos.x=a||0,this.pos.y=b||0,this.target=null,this.follow_axis=null},setDeadzone:function(a,c){this.deadzone=new b.Vector2d(~~((this.width-a)/2),~~((this.height-c)/2-.25*c)),this._deadwidth=this.width-this.deadzone.x,this._deadheight=this.height-this.deadzone.y,this.update(!0)},setBounds:function(a,b){this.limits.set(a,b),this._limitwidth=this.limits.x-this.width,this._limitheight=this.limits.y-this.height},follow:function(a,c){if(a instanceof b.ObjectEntity)this.target=a.pos;else{if(!(a instanceof b.Vector2d))throw"melonJS: invalid target for viewport.follow";this.target=a}this.follow_axis=c||this.AXIS.BOTH,this.update(!0)},move:function(a,b){var c=~~(this.pos.x+a),d=~~(this.pos.y+b);this.pos.x=c.clamp(0,this._limitwidth),this.pos.y=d.clamp(0,this._limitheight)},update:function(a){if(this.target&&a)switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:a=this._followH(this.target);break;case this.AXIS.VERTICAL:a=this._followV(this.target);break;case this.AXIS.BOTH:a=this._followH(this.target),a=this._followV(this.target)||a}if(this.shaking){var c=b.timer.getTime()-this._shake.start;c>=this._shake.duration?(this.shaking=!1,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):((this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),a=!0}return(null!=this._fadeIn.tween||null!=this._fadeOut.tween)&&(a=!0),a},shake:function(a,c,d,e){this.shaking||(this.shaking=!0,this._shake={intensity:a,duration:c,axis:d||this.AXIS.BOTH,onComplete:e||null,start:b.timer.getTime()})},fadeOut:function(a,c,d){this._fadeOut.color=a,this._fadeOut.duration=c||1e3,this._fadeOut.alpha=1,this._fadeOut.tween=new b.Tween(this._fadeOut).to({alpha:0},this._fadeOut.duration).onComplete(d||null),this._fadeOut.tween.start()},fadeIn:function(a,c,d){this._fadeIn.color=a,this._fadeIn.duration=c||1e3,this._fadeIn.alpha=0,this._fadeIn.tween=new b.Tween(this._fadeIn).to({alpha:1},this._fadeIn.duration).onComplete(d||null),this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(a){this.pos.x=a.x-.5*this.width,this.pos.y=a.y-.5*this.height},isVisible:function(a){return a.overlaps(this)},draw:function(a){this._fadeIn.tween&&(a.globalAlpha=this._fadeIn.alpha,b.video.clearSurface(a,b.utils.HexToRGB(this._fadeIn.color)),a.globalAlpha=1,1==this._fadeIn.alpha&&(this._fadeIn.tween=null)),this._fadeOut.tween&&(a.globalAlpha=this._fadeOut.alpha,b.video.clearSurface(a,b.utils.HexToRGB(this._fadeOut.color)),a.globalAlpha=1,0==this._fadeOut.alpha&&(this._fadeOut.tween=null))}})}(window),function(){b.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!0},b.entityPool=function(){var a={},c={};return a.init=function(){a.add("me.ObjectEntity",b.ObjectEntity),a.add("me.CollectableEntity",b.CollectableEntity),a.add("me.LevelEntity",b.LevelEntity)},a.add=function(a,b,d){return d?(c[a.toLowerCase()]={"class":b,pool:[],active:[]},void 0):(c[a.toLowerCase()]=b,void 0)},a.newInstanceOf=function(a){var d="string"==typeof a?a.toLowerCase():void 0;if(d&&c[d]){if(!c[d].pool){var e=c[d];return arguments[0]=e,new(e.bind.apply(e,arguments))}var f,g=c[d],e=g["class"];return g.pool.length>0?(f=g.pool.pop(),f.init.apply(f,Array.prototype.slice.call(arguments,1))):(arguments[0]=e,f=new(e.bind.apply(e,arguments)),f.className=d),g.active.push(f),f}var h=arguments[3];return h&&h.image?new b.SpriteObject(h.x,h.y,h.image):(d&&console.error("Cannot instantiate entity of type '"+a+"': Class not found!"),null)},a.purge=function(){for(className in c)c[className].pool=[]},a.freeInstance=function(a){var b=a.className;if(b&&c[b]){for(var d=!0,e=0,f=c[b].active.length;f>e;e++)if(c[b].active[e]===a){d=!1,c[b].active.splice(e,1);break}d||c[b].pool.push(a)}},a}(),b.ObjectEntity=b.Renderable.extend({GUID:null,type:0,collidable:!0,collisionBox:null,renderable:null,z:0,init:function(a,c,d){if(this.parent(new b.Vector2d(a,c),~~d.spritewidth||~~d.width,~~d.spriteheight||~~d.height),d.image){var e="string"==typeof d.image?b.loader.getImage(d.image):d.image;this.renderable=new b.AnimationSheet(0,0,e,~~d.spritewidth,~~d.spriteheight,~~d.spacing,~~d.margin),d.transparent_color&&this.renderable.setTransparency(d.transparent_color)}this.GUID=b.utils.createGUID(),this.name=d.name?d.name.toLowerCase():"",this.vel=new b.Vector2d,this.accel=new b.Vector2d,this.friction=new b.Vector2d,this.maxVel=new b.Vector2d(1e3,1e3),this.gravity=void 0!=b.sys.gravity?b.sys.gravity:.98,this.isEntity=!0,this.alive=!0,this.visible=!0,this.floating=!1,this.isPersistent=!1,this.falling=!1,this.jumping=!0,this.slopeY=0,this.onslope=!1,this.onladder=!1,this.disableTopLadderCollision=!1,this.collidable="undefined"!=typeof d.collidable?d.collidable:!0,this.type=d.type||0,this.collisionMap=b.game.collisionMap,this.collisionBox=new b.Rect(this.pos,this.width,this.height),this.canBreakTile=!1,this.onTileBreak=null},updateColRect:function(a,b,c,d){this.collisionBox.adjustSize(a,b,c,d)},onCollision:function(){this.collidable&&this.type==b.game.COLLECTABLE_OBJECT&&b.game.remove(this)},setVelocity:function(a,b){this.accel.x=0!=a?a:this.accel.x,this.accel.y=0!=b?b:this.accel.y,this.setMaxVelocity(a,b)},setMaxVelocity:function(a,b){this.maxVel.x=a,this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0,this.friction.y=b||0},flipX:function(a){a!=this.lastflipX&&(this.renderable&&this.renderable.flipX(a),this.collisionBox.flipX(this.width))},flipY:function(a){a!=this.lastflipY&&(this.renderable&&this.renderable.flipY(a),this.collisionBox.flipY(this.height))},doWalk:function(a){this.flipX(a),this.vel.x+=a?-this.accel.x*b.timer.tick:this.accel.x*b.timer.tick},doClimb:function(a){return this.onladder?(this.vel.y=a?-this.accel.x*b.timer.tick:this.accel.x*b.timer.tick,this.disableTopLadderCollision=!a,!0):!1},doJump:function(){return this.jumping||this.falling?!1:(this.vel.y=-this.maxVel.y*b.timer.tick,this.jumping=!0,!0)},forceJump:function(){this.jumping=this.falling=!1,this.doJump()},distanceTo:function(a){var b=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),c=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(b*b+c*c)},distanceToPoint:function(a){var b=this.pos.x+this.hWidth-a.x,c=this.pos.y+this.hHeight-a.y;return Math.sqrt(b*b+c*c)},angleTo:function(a){var b=a.pos.x+a.hWidth-(this.pos.x+this.hWidth),c=a.pos.y+a.hHeight-(this.pos.y+this.hHeight);return Math.atan2(c,b)},angleToPoint:function(a){var b=a.x-(this.pos.x+this.hWidth),c=a.y-(this.pos.y+this.hHeight);return Math.atan2(c,b)},checkSlope:function(a,b){this.pos.y=a.pos.y-this.height,this.slopeY=b?a.height-(this.collisionBox.right+this.vel.x-a.pos.x):this.collisionBox.left+this.vel.x-a.pos.x,this.vel.y=0,this.pos.y+=this.slopeY.clamp(0,a.height)},computeVelocity:function(a){this.gravity&&(a.y+=this.onladder?0:this.gravity*b.timer.tick,this.falling=a.y>0,this.jumping=this.falling?!1:this.jumping),this.friction.x&&(a.x=b.utils.applyFriction(a.x,this.friction.x)),this.friction.y&&(a.y=b.utils.applyFriction(a.y,this.friction.y)),0!=a.y&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y)),0!=a.x&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){if(this.computeVelocity(this.vel),this.collidable){var a=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onslope=a.yprop.isSlope||a.xprop.isSlope,this.onladder=!1,a.y&&(this.onladder=a.yprop.isLadder||a.yprop.isTopLadder,a.y>0?a.yprop.isSolid||a.yprop.isPlatform&&this.collisionBox.bottom-1<=a.ytile.pos.y||a.yprop.isTopLadder&&!this.disableTopLadderCollision?(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1):a.yprop.isSlope&&!this.jumping?(this.checkSlope(a.ytile,a.yprop.isLeftSlope),this.falling=!1):a.yprop.isBreakable&&(this.canBreakTile?(b.game.currentLevel.clearTile(a.ytile.col,a.ytile.row),this.onTileBreak&&this.onTileBreak()):(this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1)):a.y<0&&(a.yprop.isPlatform||a.yprop.isLadder||a.yprop.isTopLadder||(this.falling=!0,this.vel.y=0))),a.x&&(this.onladder=a.xprop.isLadder||a.yprop.isTopLadder,a.xprop.isSlope&&!this.jumping?(this.checkSlope(a.xtile,a.xprop.isLeftSlope),this.falling=!1):a.xprop.isPlatform||a.xprop.isLadder||a.xprop.isTopLadder||(a.xprop.isBreakable&&this.canBreakTile?(b.game.currentLevel.clearTile(a.xtile.col,a.xtile.row),this.onTileBreak&&this.onTileBreak()):this.vel.x=0))}return this.pos.add(this.vel),a},collide:function(a){return b.game.collide(this,a||!1)},collideType:function(a,c){return b.game.collideType(this,a,c||!1)},update:function(){return this.renderable?this.renderable.update():!1},getRect:function(){return this.renderable?this.renderable.getRect().translateV(this.pos):null},draw:function(a){if(this.renderable){var c=~~(this.pos.x+this.anchorPoint.x*(this.width-this.renderable.width)),d=~~(this.pos.y+this.anchorPoint.y*(this.height-this.renderable.height));a.translate(c,d),this.renderable.draw(a),a.translate(-c,-d)}if(b.debug.renderHitBox&&this.collisionBox&&this.collisionBox.draw(a,"red"),b.debug.renderVelocity){var c=~~(this.pos.x+this.hWidth),d=~~(this.pos.y+this.hHeight);a.strokeStyle="blue",a.lineWidth=1,a.beginPath(),a.moveTo(c,d),a.lineTo(c+~~(this.vel.x*this.hWidth),d+~~(this.vel.y*this.hHeight)),a.stroke()}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null),this.onDestroyEvent.apply(this,arguments),this.pos=null,this.collisionBox=null},onDestroyEvent:function(){}}),b.CollectableEntity=b.ObjectEntity.extend({init:function(a,c,d){this.parent(a,c,d),this.type=b.game.COLLECTABLE_OBJECT}}),b.LevelEntity=b.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c),this.nextlevel=c.to,this.fade=c.fade,this.duration=c.duration,this.fading=!1,this.gotolevel=c.to},onFadeComplete:function(){b.levelDirector.loadLevel(this.gotolevel),b.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel,this.fade&&this.duration?this.fading||(this.fading=!0,b.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):b.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})}(window),function(a){b.ScreenObject=b.Renderable.extend({addAsObject:!1,z:999,init:function(a,c){this.parent(new b.Vector2d(0,0),0,0),this.addAsObject=this.visible=a===!0||!1,this.isPersistent=this.visible&&c===!0||!1},reset:function(){b.game.reset(),this.onResetEvent.apply(this,arguments),this.addAsObject&&(this.visible=!0,this.set(b.game.viewport.pos,b.game.viewport.width,b.game.viewport.height),b.game.add(this,this.z)),b.game.sort()
},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},onUpdateFrame:function(){b.timer.update(),b.game.update(),b.game.draw(),b.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}}),b.state=function(){function c(){if(-1==k&&-1==l){if(b.timer.reset(),b.sys.useNativeAnimFrame){if(l=window.requestAnimationFrame(d),-1!=l)return;b.sys.useNativeAnimFrame=!1}k=setInterval(q,~~(1e3/b.sys.fps))}}function d(){q(),-1!=l&&(l=window.requestAnimationFrame(d))}function e(){-1!=k&&(clearInterval(k),k=-1),-1!=l&&(window.cancelAnimationFrame(l),l=-1)}function f(a){e(),m[j]&&(m[j].screen.visible&&b.game.remove.call(b.game,m[j].screen,!0),m[j].screen.destroy()),m[a]&&(j=a,m[j].screen.reset.apply(m[j].screen,p),q=m[j].screen.onUpdateFrame.bind(m[j].screen),c(),o&&o(),b.game.repaint())}for(var g=["ms","moz","webkit","o"],h=0;h<g.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[g[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[g[h]+"CancelAnimationFrame"]||window[g[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(){return-1}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return-1});var i={},j=-1,k=-1,l=-1,m={},n={color:"",duration:0},o=null,p=null,q=null;return i.LOADING=0,i.MENU=1,i.READY=2,i.PLAY=3,i.GAMEOVER=4,i.GAME_END=5,i.SCORE=6,i.CREDITS=7,i.SETTINGS=8,i.USER=100,i.onPause=null,i.onResume=null,i.init=function(){i.set(i.LOADING,b.loadingScreen),a.addEventListener("blur",function(){b.sys.pauseOnBlur&&j!=i.LOADING&&i.pause(!0),i.onPause&&i.onPause(),b.event.publish(b.event.STATE_PAUSE)},!1),a.addEventListener("focus",function(){b.sys.pauseOnBlur&&j!=i.LOADING&&(i.resume(!0),b.game.repaint()),i.onResume&&i.onResume(),b.event.publish(b.event.STATE_RESUME)},!1)},i.pause=function(a){e(),a&&b.audio.pauseTrack()},i.resume=function(a){c(),a&&b.audio.resumeTrack()},i.isRunning=function(){return-1!=k||-1!=l},i.set=function(a,b){m[a]={},m[a].screen=b,m[a].transition=!0},i.current=function(){return m[j].screen},i.transition=function(a,b,c){"fade"==a&&(n.color=b,n.duration=c)},i.setTransition=function(a,b){m[a].transition=b},i.change=function(a){if("undefined"==typeof m[a])throw"melonJS : Undefined ScreenObject for state '"+a+"'";p=null,arguments.length>1&&(p=Array.prototype.slice.call(arguments,1)),n.duration&&m[a].transition?(o=function(){b.game.viewport.fadeOut(n.color,n.duration)},b.game.viewport.fadeIn(n.color,n.duration,function(){f.defer(a)})):f.defer(a)},i.isCurrent=function(a){return j==a},i}()}(window),function(){b.DefaultLoadingScreen=b.ScreenObject.extend({init:function(){this.parent(!0),this.invalidate=!1,this.handle=null},onResetEvent:function(){this.logo1=new b.Font("century gothic",32,"white","middle"),this.logo2=new b.Font("century gothic",32,"#89b002","middle"),this.logo2.bold(),this.logo1.textBaseline=this.logo2.textBaseline="alphabetic",this.handle=b.event.subscribe(b.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this)),this.loadPercent=0},onDestroyEvent:function(){this.logo1=this.logo2=null,this.handle&&(b.event.unsubscribe(this.handle),this.handle=null)},onProgressUpdate:function(a){this.loadPercent=a,this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},draw:function(a){var c=this.logo1.measureText(a,"melon").width,d=(b.video.getWidth()-c-this.logo2.measureText(a,"JS").width)/2,e=b.video.getHeight()/2;b.video.clearSurface(a,"black"),this.logo1.draw(a,"melon",d,e),d+=c,this.logo2.draw(a,"JS",d,e),e+=this.logo1.measureText(a,"melon").height/2;var f=Math.floor(this.loadPercent*b.video.getWidth());a.strokeStyle="silver",a.strokeRect(0,e,b.video.getWidth(),6),a.fillStyle="#89b002",a.fillRect(2,e+2,f-4,2)}}),b.loader=function(){function a(){m==l?g.onload?(clearTimeout(n),setTimeout(function(){g.onload(),b.event.publish(b.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):n=setTimeout(a,100)}function c(a,c,d){h[a.name]=new Image,h[a.name].onload=c,h[a.name].onerror=d,h[a.name].src=a.src+b.nocache}function d(a,c,d){var e=new XMLHttpRequest,f=b.utils.getFileExtension(a.src).toLowerCase();e.overrideMimeType&&("json"===f?e.overrideMimeType("application/json"):e.overrideMimeType("text/xml")),e.open("GET",a.src+b.nocache,!0),"tmx"===a.type&&b.levelDirector.addTMXLevel(a.name),e.ontimeout=d,e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||0==e.status&&e.responseText){var g=null;switch(f){case"xml":case"tmx":g=b.sys.ua.match(/msie/i)||!e.responseXML?(new DOMParser).parseFromString(e.responseText,"text/xml"):e.responseXML,f="xml";break;case"json":g=JSON.parse(e.responseText);break;default:throw"melonJS: TMX file format "+f+"not supported !"}i[a.name]={data:g,isTMX:"tmx"===a.type,format:f},c()}else d()},e.send(null)}function e(a,c,d){var e=new XMLHttpRequest;e.overrideMimeType&&e.overrideMimeType("application/json"),e.open("GET",a.src+b.nocache,!0),e.ontimeout=d,e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status&&e.responseText?(k[a.name]=JSON.parse(e.responseText),c()):d())},e.send(null)}function f(a,c,d){var e=new XMLHttpRequest;e.open("GET",a.src+b.nocache,!1),e.responseType="arraybuffer",e.onerror=d,e.onload=function(){var b=e.response;if(b){var d=new Uint8Array(b),f=[];j[a.name]=new dataType;for(var g=0;g<d.byteLength;g++)f[g]=String.fromCharCode(d[g]);j[a.name].data=f.join(""),c()}},e.send()}var g={},h={},i={},j={},k={},l=0,m=0,n=0;return g.onload=void 0,g.onProgress=void 0,g.onResourceLoaded=function(){m++;var a=g.getLoadProgress();g.onProgress&&g.onProgress(a),b.event.publish(b.event.LOADER_PROGRESS,[a])},g.onLoadingError=function(a){throw"melonJS: Failed loading resource "+a.src},g.preload=function(b){for(var c=0;c<b.length;c++)l+=g.load(b[c],g.onResourceLoaded.bind(g),g.onLoadingError.bind(g,b[c]));a()},g.load=function(a,g,h){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return f.call(this,a,g,h),1;case"image":return c.call(this,a,g,h),1;case"tps":return e.call(this,a,g,h),1;case"tmx":case"tsx":return d.call(this,a,g,h),1;case"audio":if(b.audio.isAudioEnable())return b.audio.load(a,g,h),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+a.type}return 0},g.unload=function(a){switch(a.name=a.name.toLowerCase(),a.type){case"binary":return a.name in j?(delete j[a.name],!0):!1;case"image":return a.name in h?(delete h[a.name],!0):!1;case"tps":return a.name in k?(delete k[a.name],!0):!1;case"tmx":case"tsx":return a.name in i?(delete i[a.name],!0):!1;case"audio":return b.audio.unload(a.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+a.type}},g.unloadAll=function(){var a;for(a in j)g.unload(a);for(a in h)g.unload(a);for(a in i)g.unload(a);for(a in k)g.unload(a);b.audio.unloadAll()},g.getTMXFormat=function(a){return a=a.toLowerCase(),a in i?i[a].format:null},g.getTMX=function(a){return a=a.toLowerCase(),a in i?i[a].data:null},g.getBinary=function(a){return a=a.toLowerCase(),a in j?j[a]:null},g.getAtlas=function(a){return a=a.toLowerCase(),a in k?k[a]:null},g.getImage=function(a){if(a=a.toLowerCase(),a in h){if(b.sys.cacheImage===!0){var c=b.video.createCanvasSurface(h[a].width,h[a].height);return c.drawImage(h[a],0,0),c.canvas}return h[a]}return null},g.getLoadProgress=function(){return m/l},g}()}(window),function(){b.Font=Object.extend({font:null,height:null,color:null,textAlign:"left",textBaseline:"top",lineHeight:1,init:function(a,b,c,d){this.set(a,b,c,d)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(a,b,c,d){for(var e=a.split(","),f=0;f<e.length;f++)e[f]="'"+e[f]+"'";this.height=parseInt(b),"number"==typeof b&&(b=""+b+"px"),this.font=b+" "+e.join(","),this.color=c,d&&(this.textAlign=d)},getRect:function(){return new b.Rect(new Vector2d(0,0),0,0)},measureText:function(a,b){a.font=this.font,a.fillStyle=this.color,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var c=(""+b).split("\n"),d=0,e=0,f=0;f<c.length;f++)d=Math.max(a.measureText(c[f].trim()).width,d),e+=this.height*this.lineHeight;return{width:d,height:e}},draw:function(a,b,c,d){a.font=this.font,a.fillStyle=this.color,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline;for(var e=(""+b).split("\n"),f=0;f<e.length;f++)a.fillText(e[f].trim(),~~c,~~d),d+=this.height*this.lineHeight}}),b.BitmapFont=b.Font.extend({size:null,sSize:null,firstChar:32,charCount:0,init:function(a,c,d,e){this.parent(a,null,null),this.size=new b.Vector2d,this.sSize=new b.Vector2d,this.firstChar=e||32,this.loadFontMetrics(a,c),this.textAlign="left",this.textBaseline="top",d&&this.resize(d)},loadFontMetrics:function(a,c){this.font=b.loader.getImage(a),this.size.x=c.x||c,this.size.y=c.y||this.font.height,this.sSize.copy(this.size),this.charCount=~~(this.font.width/this.size.x)},set:function(a,b){this.textAlign=a,b&&this.resize(b)},resize:function(a){this.sSize.setV(this.size),this.sSize.x*=a,this.sSize.y*=a},measureText:function(a,b){for(var c=(""+b).split("\n"),d=0,e=0,f=0;f<c.length;f++)d=Math.max(c[f].trim().length*this.sSize.x,d),e+=this.sSize.y*this.lineHeight;return{width:d,height:e}},draw:function(a,b,c,d){for(var e=(""+b).split("\n"),f=c,g=this.sSize.y*this.lineHeight,h=0;h<e.length;h++){var c=f,d=d,i=e[h].trim(),j=i.length*this.sSize.x;switch(this.textAlign){case"right":c-=j;break;case"center":c-=.5*j}switch(this.textBaseline){case"middle":d-=.5*g;break;case"ideographic":case"alphabetic":case"bottom":d-=g}for(var k=0,l=i.length;l>k;k++){var m=i.charCodeAt(k)-this.firstChar;a.drawImage(this.font,this.size.x*(m%this.charCount),this.size.y*~~(m/this.charCount),this.size.x,this.size.y,~~c,~~d,this.sSize.x,this.sSize.y),c+=this.sSize.x}d+=g}}})}(window),function(){b.GUI_Object=b.SpriteObject.extend({isClickable:!0,updated:!1,init:function(a,c,d){this.parent(a,c,"string"==typeof d.image?b.loader.getImage(d.image):d.image,d.spritewidth,d.spriteheight),this.floating=!0,b.input.registerMouseEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(){return this.isClickable?(this.updated=!0,this.onClick()):void 0},onClick:function(){return!0},onDestroyEvent:function(){b.input.releaseMouseEvent("mousedown",this)}})}(window),function(){b.HUD_Item=Object.extend({init:function(a,c,d){this.pos=new b.Vector2d(a||0,c||0),this.visible=!0,this.defaultvalue=d||0,this.value=d||0,this.updated=!0},reset:function(){this.set(this.defaultvalue)},set:function(a){return this.value=a,this.updated=!0,!0},update:function(a){return this.set(this.value+a)},draw:function(){}}),b.HUD_Object=b.Renderable.extend({init:function(a,c,d,e,f){this.parent(new b.Vector2d(a||0,c||0),d||b.video.getWidth(),e||b.video.getHeight()),this.bgcolor=f,this.HUDItems={},this.HUDobj=[],this.objCount=0,this.visible=!0,this.floating=!0,this.HUD_invalidated=!0,this.HUDCanvas=b.video.createCanvas(this.width,this.height),this.HUDCanvasSurface=this.HUDCanvas.getContext("2d"),b.video.setImageSmoothing(this.HUDCanvasSurface,b.sys.scalingInterpolation),this.z=999,this.isPersistent=!0},addItem:function(a,b){this.HUDItems[a]=b,this.HUDobj.push(this.HUDItems[a]),this.objCount++,this.HUD_invalidated=!0},removeItem:function(a){this.HUDItems[a]&&(this.HUDobj.splice(this.HUDobj.indexOf(this.HUDItems[a]),1),this.HUDItems[a]=null,this.objCount--,this.HUD_invalidated=!0)},setItemValue:function(a,b){this.HUDItems[a]&&1==this.HUDItems[a].set(b)&&(this.HUD_invalidated=!0)},updateItemValue:function(a,b){this.HUDItems[a]&&1==this.HUDItems[a].update(b)&&(this.HUD_invalidated=!0)},getItemValue:function(a){return this.HUDItems[a]?this.HUDItems[a].value:0},update:function(){return this.HUD_invalidated},reset:function(a){void 0!=a?(this.HUDItems[a]&&this.HUDItems[a].reset(),this.HUD_invalidated=!0):this.resetAll()},resetAll:function(){for(var a,b=this.objCount;b--,a=this.HUDobj[b];)a.reset();this.HUD_invalidated=!0},draw:function(a){if(this.HUD_invalidated){this.bgcolor?b.video.clearSurface(this.HUDCanvasSurface,this.bgcolor):this.HUDCanvas.width=this.HUDCanvas.width;for(var c,d=this.objCount;d--,c=this.HUDobj[d];)c.visible&&(c.draw(this.HUDCanvasSurface,0,0),c.updated&&(c.updated=!1))}a.drawImage(this.HUDCanvas,this.pos.x,this.pos.y),this.HUD_invalidated=!1}})}(window),function(){b.audio=function(){function a(a){var c="",d=a.length;if(b.sys.sound)for(var e="",f=0;d>f&&(e=a[f].toLowerCase().trim(),!h.capabilities[e]||!h.capabilities[e].canPlay||""!==c&&"probably"!==h.capabilities[e].canPlayType||(c=e,"probably"!==h.capabilities[e].canPlayType));f++);return""===c&&(m=!1),c}function c(a){for(var b,c=i[a],d=0;b=c[d++];)if(b.ended||!b.currentTime)return b.currentTime=n,b;return c[0].pause(),c[0].currentTime=n,c[0]}function d(a,c){if(o++>3){var d="melonJS: failed loading "+a+"."+j;if(b.sys.stopOnAudioError!==!1)throw d;b.audio.disable(),c&&c(),console.log(d+", disabling audio")}else i[a][0].load()}function e(a,b,c){if(o=0,b>1)for(var d=i[a][0],e=1;b>e;e++)i[a][e]=new Audio(d.src),i[a][e].preload="auto",i[a][e].load();c&&c()}function f(a,b,d,e){var f=c(a.toLowerCase());return f.loop=b||!1,f.volume=e?parseFloat(e).clamp(0,1):p.volume,f.muted=p.muted,f.play(),d&&!b&&f.addEventListener("ended",function(){f.removeEventListener("ended",arguments.callee,!1),d()},!1),f}function g(a,b,c){return c&&!b&&setTimeout(c,2e3),null}var h={},i={},j=-1,k=null,l=null,m=!0,n=0,o=0,p={volume:1,muted:!1},q=!1,r=[];return h.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}},h.detectCapabilities=function(){var a=document.createElement("audio");if(a.canPlayType)for(var c in h.capabilities){var d=a.canPlayType(h.capabilities[c].codec);""!==d&&"no"!==d&&(h.capabilities[c].canPlay=!0,h.capabilities[c].canPlayType=d),b.sys.sound|=h.capabilities[c].canPlay}},h.init=function(c){if(!b.initialized)throw"melonJS: me.audio.init() called before engine initialization.";return c=new String(c?c:"mp3"),c=c.split(","),j=a(c),b.sys.isMobile&&!navigator.isCocoonJS&&(m=!1),h.play=h.isAudioEnable()?f:g,h.isAudioEnable()},h.isAudioEnable=function(){return m},h.enable=function(){m=b.sys.sound,h.play=m?f:g},h.disable=function(){b.audio.stopTrack(),h.play=g,m=!1},h.load=function(a,c,f){if(-1==j)return 0;if(b.sys.isMobile&&!navigator.isCocoonJS){if(q)return r.push([a,c,f]),void 0;q=!0}var g=a.channel||1,k="canplaythrough";a.stream!==!0||b.sys.isMobile||(g=1,k="canplay");var l=new Audio(a.src+a.name+"."+j+b.nocache);return l.preload="auto",l.addEventListener(k,function(){l.removeEventListener(k,arguments.callee,!1),q=!1,e.call(b.audio,a.name,g,c);var d=r.shift();d&&h.load.apply(h,d)},!1),l.addEventListener("error",function(){d.call(b.audio,a.name,f)},!1),l.load(),i[a.name]=[l],1},h.stop=function(a){if(m)for(var b=i[a.toLowerCase()],c=b.length;c--;)b[c].pause(),b[c].currentTime=n},h.pause=function(a){if(m)for(var b=i[a.toLowerCase()],c=b.length;c--;)b[c].pause()},h.playTrack=function(a,c){l=b.audio.play(a,!0,null,c),k=a.toLowerCase()},h.stopTrack=function(){m&&l&&(l.pause(),k=null,l=null)},h.setVolume=function(a){"number"==typeof a&&(p.volume=a.clamp(0,1))},h.getVolume=function(){return p.volume},h.mute=function(a,b){b=void 0===b?!0:!!b;for(var c,d=i[a.toLowerCase()],e=0;c=d[e++];)c.muted=b},h.unmute=function(a){h.mute(a,!1)},h.muteAll=function(){p.muted=!0;for(var a in i)h.mute(a,p.muted)},h.unmuteAll=function(){p.muted=!1;for(var a in i)h.mute(a,p.muted)},h.getCurrentTrack=function(){return k},h.pauseTrack=function(){m&&l&&l.pause()},h.resumeTrack=function(){m&&l&&l.play()},h.unload=function(a){return a=a.toLowerCase(),a in i?(k===a?h.stopTrack():h.stop(a),delete i[a],!0):!1},h.unloadAll=function(){for(var a in i)h.unload(a)},h}()}(window),function(){b.timer=function(){function a(a){d.replaceChild(document.createTextNode("("+a+"/"+b.sys.fps+" fps)"),d.firstChild)}var c={},d=null,e=0,f=0,g=0,h=0,i=0,j=Math.ceil(1e3/b.sys.fps),k=1.25*(1e3/b.sys.fps);return c.tick=1,c.fps=0,c.init=function(){d=document.getElementById("framecounter"),null!==d&&(b.debug.displayFPS=!0),c.reset()},c.reset=function(){h=g=Date.now(),f=0,e=0},c.getTime=function(){return h},c.update=function(){g=h,h=Date.now(),i=h-g,b.debug.displayFPS&&(e++,f+=i,0==e%10&&(this.fps=(~~(1e3*e/f)).clamp(0,b.sys.fps),f=0,e=0),null!==d&&a(this.fps)),c.tick=i>k&&b.sys.interpolation?i/j:1},c}(),b.video=function(){function a(){return navigator.isCocoonJS&&!b.sys.dirtyRegion?"screencanvas":"canvas"}var c={},d=null,e=null,f=null,g=null,h=null,i=-1,j=!1,k=0,l=0,m=!1,n=!0;return c.init=function(a,i,o,p,q,r){if(!b.initialized)throw"melonJS: me.video.init() called before engine initialization.";return j=p||!1,m="auto"===q||!1,n=void 0!==r?r:!0,q="auto"!==q?parseFloat(q||1):1,b.sys.scale=new b.Vector2d(q,q),(m||1!==q)&&(j=!0),k=i*b.sys.scale.x,l=o*b.sys.scale.y,window.addEventListener("resize",function(a){b.event.publish(b.event.WINDOW_ONRESIZE,[a])},!1),window.addEventListener("orientationchange",function(a){b.event.publish(b.event.WINDOW_ONRESIZE,[a])},!1),b.event.subscribe(b.event.WINDOW_ONRESIZE,b.video.onresize.bind(b.video)),d=c.createCanvas(k,l,!0),a&&(h=document.getElementById(a)),h||(h=document.body),h.appendChild(d),d.getContext?(e=d.getContext("2d"),e.canvas||(e.canvas=d),b.video.setImageSmoothing(e,b.sys.scalingInterpolation),j?(f=c.createCanvas(i,o,!1),g=f.getContext("2d"),g.canvas||(g.canvas=f),b.video.setImageSmoothing(g,b.sys.scalingInterpolation)):(f=d,g=e),m&&b.video.onresize(null),!0):!1},c.getWrapper=function(){return h},c.getWidth=function(){return f.width},c.getPos=function(a){for(var c=a||d,e=new b.Vector2d(c.offsetLeft,c.offsetTop);c=c.offsetParent;)e.x+=c.offsetLeft,e.y+=c.offsetTop;return e},c.getHeight=function(){return f.height},c.createCanvas=function(b,c,d){if(0===b||0===c)throw new Error("melonJS: width or height was zero, Canvas could not be initialized !");var e=d===!0?a():"canvas",g=document.createElement(e);return g.width=b||f.width,g.height=c||f.height,g},c.createCanvasSurface=function(a,d){var e=c.createCanvas(a,d,!1),f=e.getContext("2d");return f.canvas||(f.canvas=e),b.video.setImageSmoothing(f,b.sys.scalingInterpolation),f},c.getScreenCanvas=function(){return d},c.getScreenContext=function(){return e},c.getSystemCanvas=function(){return f},c.getSystemContext=function(){return g},c.onresize=function(){if(m){var a=b.video.getScreenCanvas().parentNode,c=a.width||window.innerWidth,d=a.height||window.innerHeight;if(i&&clearTimeout(i),n){var e=b.video.getWidth()/b.video.getHeight(),f=c/d;if(e>f)var g=c/b.video.getWidth();else var g=d/b.video.getHeight();i=b.video.updateDisplaySize.defer(g,g)}else i=b.video.updateDisplaySize.defer(c/b.video.getWidth(),d/b.video.getHeight())}else b.input.mouse.offset=b.video.getPos()},c.updateDisplaySize=function(a,e){b.sys.scale.set(a,e),d.width=k=f.width*a,d.height=l=f.height*e,b.input.mouse.offset=b.video.getPos(),c.blitSurface(),i=-1},c.clearSurface=function(a,b){var c=a.canvas.width,d=a.canvas.height;a.save(),a.setTransform(1,0,0,1,0,0),"rgba"===b.substr(0,4)&&a.clearRect(0,0,c,d),a.fillStyle=b,a.fillRect(0,0,c,d),a.restore()},c.scale=function(a,b){a.translate(-(a.canvas.width*b-a.canvas.width>>1),-(a.canvas.height*b-a.canvas.height>>1)),a.scale(b,b)},c.setImageSmoothing=function(a,b){for(var c=["ms","moz","webkit","o"],d=0;d<c.length;++d)void 0!==a[c[d]+"ImageSmoothingEnabled"]&&(a[c[d]+"ImageSmoothingEnabled"]=b===!0);a.imageSmoothingEnabled=b===!0},c.setAlpha=function(a,b){a.globalCompositeOperation=b?"source-over":"copy"},c.blitSurface=function(){c.blitSurface=j?function(){e.drawImage(f,0,0,f.width,f.height,0,0,k,l)}:function(){},c.blitSurface()},c.applyRGBFilter=function(a,d,e){var f=c.createCanvasSurface(a.width,a.height,!1),g=b.utils.getPixels(a),h=g.data;switch(d){case"b&w":for(var i=0,j=h.length;j>i;i+=4){var k=3*h[i]+4*h[i+1]+h[i+2]>>>3;h[i]=k,h[i+1]=k,h[i+2]=k}break;case"brightness":for(var l=Math.abs(e).clamp(0,1),i=0,j=h.length;j>i;i+=4)h[i]*=l,h[i+1]*=l,h[i+2]*=l;break;case"transparent":for(var i=0,j=h.length;j>i;i+=4)b.utils.RGBToHex(h[i],h[i+1],h[i+2])===e&&(h[i+3]=0);break;default:return null}return f.putImageData(g,0,0),f},c}()}(window),function(a){b.input=function(){function c(){t||(a.addEventListener("keydown",f,!1),a.addEventListener("keyup",g,!1),t=!0)}function d(){if(!u){if(o.touches.push({x:0,y:0}),o.mouse.pos=new b.Vector2d(0,0),o.mouse.offset=b.video.getPos(),b.sys.touch){b.video.getScreenCanvas().addEventListener("touchmove",k,!1);for(var c=2;c<x.length;++c)b.video.getScreenCanvas().addEventListener(x[c],m,!1)}else{b.video.getScreenCanvas().addEventListener("mousemove",k,!1),a.addEventListener("mousewheel",j,!1);for(var c=2;c<w.length;++c)b.video.getScreenCanvas().addEventListener(w[c],l,!1)}u=!0}}function e(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function f(a,c){var d=p[c||a.keyCode||a.which];return d?(s[d]||(q[d]=!0,s[d]=r[d],b.event.publish(b.event.KEYDOWN,[d])),e(a)):!0}function g(a,c){var d=p[c||a.keyCode||a.which];return d?(q[d]=!1,s[d]=!1,b.event.publish(b.event.KEYUP,[d]),e(a)):!0}function h(a){var c=!1,d=o.mouse.handlers[a.type];if(d)for(var e=b.game.viewport.pos,f=b.game.currentLevel.pos,g=0,h=o.touches.length;h>g;g++)for(var i,j=o.touches[g].x,k=o.touches[g].y,l=d.length;l--,i=d[l];){if(i.floating===!1)var m={x:j+e.x-f.x,y:k+e.y-f.y};else var m={x:j,y:k};if((null===i.rect||i.rect.containsPoint(m))&&i.cb(a)===!1){c=!0;break}}return c}function i(a){if(o.touches.length=0,a.touches)for(var c=o.mouse.offset,d=0,e=a.changedTouches.length;e>d;d++){var f=a.changedTouches[d],g=f.clientX-c.x,h=f.clientY-c.y,i=b.sys.scale;(1!=i.x||1!=i.y)&&(g/=i.x,h/=i.y),o.touches.push({x:g,y:h,id:f.identifier})}else{var c=o.mouse.offset,g=a.pageX-c.x,h=a.pageY-c.y,i=b.sys.scale;(1!=i.x||1!=i.y)&&(g/=i.x,h/=i.y),o.touches.push({x:g,y:h,id:0})}o.mouse.pos.set(o.touches[0].x,o.touches[0].y)}function j(a){return a.target==b.video.getScreenCanvas()&&h(a)?e(a):!0}function k(a){return i(a),h(a)?e(a):!0}function l(a){if(h(a))return e(a);var b=o.mouse.bind[a.button||0];return b?"mousedown"===a.type||"touchstart"===a.type?f(a,b):g(a,b):!0}function m(a){return i(a),l(a)}function n(a){o.accel=a.accelerationIncludingGravity}var o={},p={},q={},r={},s={},t=!1,u=!1,v=!1,w=["mousewheel","mousemove","mousedown","mouseup","click","dblclick"],x=[void 0,"touchmove","touchstart","touchend","tap","dbltap"];return o.accel={x:0,y:0,z:0},o.mouse={pos:null,offset:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0],handlers:{}},o.touches=[],o.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},o.isKeyPressed=function(a){return q[a]?(r[a]&&(s[a]=!0,q[a]=!1),!0):!1},o.keyStatus=function(a){return s[a]===!0?!0:q[a]},o.triggerKeyEvent=function(a,b){b?f({},a):g({},a)},o.bindKey=function(a,b,d){c(),p[a]=b,q[b]=!1,r[b]=d?d:!1,s[b]=!1},o.unlockKey=function(a){s[a]=!1},o.unbindKey=function(a){q[p[a]]=!1,r[p[a]]=!1,p[a]=null},o.bindMouse=function(a,b){if(d(),!p[b])throw"melonJS : no action defined for keycode "+b;o.mouse.bind[a]=b},o.unbindMouse=function(a){o.mouse.bind[a]=null},o.bindTouch=function(a){o.bindMouse(b.input.mouse.LEFT,a)},o.unbindTouch=function(){o.unbindMouse(b.input.mouse.LEFT)},o.registerMouseEvent=function(a,c,e,f){if(d(),b.sys.touch&&-1!==w.indexOf(a)&&(a=x[w.indexOf(a)]),a&&(-1!==w.indexOf(a)||-1!==x.indexOf(a))){o.mouse.handlers[a]||(o.mouse.handlers[a]=[]);var g=c.floating===!0?!0:!1;return f&&(g=f===!0?!0:!1),o.mouse.handlers[a].push({rect:c||null,cb:e,floating:g}),void 0}throw"melonJS : invalid event type : "+a},o.releaseMouseEvent=function(a,c){b.sys.touch&&-1!==w.indexOf(a)&&(a=x[w.indexOf(a)]);{if(!a||-1===w.indexOf(a)&&-1===x.indexOf(a))throw"melonJS : invalid event type : "+a;o.mouse.handlers[a]||(o.mouse.handlers[a]=[]);var d=o.mouse.handlers[a];if(d)for(var e,f=d.length;f--,e=d[f];)e.rect===c&&(e.rect=e.cb=e.floating=null,o.mouse.handlers[a].splice(f,1))}},o.watchAccelerometer=function(){return a.sys.gyro?(v||(a.addEventListener("devicemotion",n,!1),v=!0),!0):!1},o.unwatchAccelerometer=function(){v&&(a.removeEventListener("devicemotion",n,!1),v=!1)},o}()}(window),function(a){var c=function(){var c={},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return c.decode=function(c){if(c=c.replace(/[^A-Za-z0-9\+\/\=]/g,""),b.sys.nativeBase64)return a.atob(c);for(var e,f,g,h,i,j,k,l=[],m=0;m<c.length;)h=d.indexOf(c.charAt(m++)),i=d.indexOf(c.charAt(m++)),j=d.indexOf(c.charAt(m++)),k=d.indexOf(c.charAt(m++)),e=h<<2|i>>4,f=(15&i)<<4|j>>2,g=(3&j)<<6|k,l.push(String.fromCharCode(e)),64!=j&&l.push(String.fromCharCode(f)),64!=k&&l.push(String.fromCharCode(g));return l=l.join("")},c}();b.utils=function(){var a={},d={},e="",f=0,g=/^.*(\\|\/|\:)/,h=/\.[^\.]*$/;return a.decodeBase64=function(a){return c.decode(a)},a.decodeBase64AsArray=function(a,b){b=b||1;var d,e,f,g=c.decode(a);if("function"==typeof window.Uint32Array)var h=new Uint32Array(g.length/b);else var h=[];for(d=0,f=g.length/b;f>d;d++)for(h[d]=0,e=b-1;e>=0;--e)h[d]+=g.charCodeAt(d*b+e)<<(e<<3);return h},a.decompress=function(){throw"melonJS: GZIP/ZLIB compressed TMX Tile Map not supported!"},a.decodeCSV=function(a,b){a=a.trim().split("\n");for(var c=[],d=0;d<a.length;d++){entries=a[d].split(",",b);for(var e=0;e<entries.length;e++)c.push(+entries[e])}return c},a.getBasename=function(a){return a.replace(g,"").replace(h,"")},a.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},a.setNocache=function(a){b.nocache=a?"?"+parseInt(1e7*Math.random()):""},a.HexToRGB=function(a,b){if("#"!==a.charAt(0))return a;if(a=a.substring(1,a.length),null==d[a]){if(a.length<6)var c=a.charAt(0)+a.charAt(0),e=a.charAt(1)+a.charAt(1),f=a.charAt(2)+a.charAt(2);else var c=a.substring(0,2),e=a.substring(2,4),f=a.substring(4,6);d[a]=parseInt(c,16)+","+parseInt(e,16)+","+parseInt(f,16)}return(b?"rgba(":"rgb(")+d[a]+(b?","+b+")":")")},a.RGBToHex=function(a,b,c){return a.toHex()+b.toHex()+c.toHex()},a.getPixels=function(a){if(a instanceof HTMLImageElement){var c=b.video.createCanvasSurface(a.width,a.height);return c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,0,a.width,a.height)},a.resetGUID=function(a){e=a.toString().toUpperCase().toHex(),f=0},a.createGUID=function(){return e+"-"+f++},a.applyFriction=function(a,c){return 0>a+c?a+c*b.timer.tick:a-c>0?a-c*b.timer.tick:0},a}()}(window),function(){function a(a){this.defaultvalue=a||0,this.value=a||0,this.updated=!0}a.prototype.reset=function(){this.set(this.defaultvalue)},a.prototype.update=function(a){return this.set(this.value+a)},a.prototype.set=function(a){return this.value=a,this.updated=!0,this.updated},b.gamestat=function(){var b={},c={},d=[],e=0;return b.add=function(b,f){var g=function(b,f){c[b]=new a(f),d.push(c[b]),e++};if(b.constructor===Object)for(var h in b)g(h,b[h]);else g(b,f)},b.updateValue=function(a,b){var d=function(a,b){c[a].update(b)};if(a.constructor===Object)for(var e in a)c[e]&&d(e,a[e]);else c[a]&&d(a,b)},b.setValue=function(a,b){var d=function(a,b){c[a].set(b)};if(a.constructor===Object)for(var e in a)c[e]&&d(e,a[e]);else c[a]&&d(a,b)},b.getItemValue=function(a){return c[a]?c[a].value:0},b.reset=function(a){void 0!=a?c[a]&&c[a].reset():b.resetAll()},b.resetAll=function(){for(var a,b=e;b--,a=d[b];)a.reset()},b}()}(window),function(){b.COLLISION_LAYER="collision",b.TMX_TAG_MAP="map",b.TMX_TAG_NAME="name",b.TMX_TAG_VALUE="value",b.TMX_TAG_VERSION="version",b.TMX_TAG_ORIENTATION="orientation",b.TMX_TAG_WIDTH="width",b.TMX_TAG_HEIGHT="height",b.TMX_TAG_OPACITY="opacity",b.TMX_TAG_TRANS="trans",b.TMX_TAG_TILEWIDTH="tilewidth",b.TMX_TAG_TILEHEIGHT="tileheight",b.TMX_TAG_TILEOFFSET="tileoffset",b.TMX_TAG_FIRSTGID="firstgid",b.TMX_TAG_GID="gid",b.TMX_TAG_TILE="tile",b.TMX_TAG_ID="id",b.TMX_TAG_DATA="data",b.TMX_TAG_COMPRESSION="compression",b.TMX_TAG_GZIP="gzip",b.TMX_TAG_ZLIB="zlib",b.TMX_TAG_ENCODING="encoding",b.TMX_TAG_ATTR_BASE64="base64",b.TMX_TAG_CSV="csv",b.TMX_TAG_SPACING="spacing",b.TMX_TAG_MARGIN="margin",b.TMX_TAG_PROPERTIES="properties",b.TMX_TAG_PROPERTY="property",b.TMX_TAG_IMAGE="image",b.TMX_TAG_SOURCE="source",b.TMX_TAG_VISIBLE="visible",b.TMX_TAG_TILESET="tileset",b.TMX_TAG_LAYER="layer",b.TMX_TAG_TILE_LAYER="tilelayer",b.TMX_TAG_IMAGE_LAYER="imagelayer",b.TMX_TAG_OBJECTGROUP="objectgroup",b.TMX_TAG_OBJECT="object",b.TMX_TAG_X="x",b.TMX_TAG_Y="y",b.TMX_TAG_WIDTH="width",b.TMX_TAG_HEIGHT="height",b.TMX_TAG_POLYGON="polygon",b.TMX_TAG_POLYLINE="polyline",b.TMX_TAG_POINTS="points",b.TMX_BACKGROUND_COLOR="backgroundcolor"}(window),function(){b.TMXUtils=function(){function a(a){if(!a||a.isBoolean())a=a?"true"===a:!0;else if(a.isNumeric())a=Number(a);else if(a.match(/^json:/i)){var b=a.split(/^json:/i)[1];try{a=JSON.parse(b)}catch(c){throw"Unable to parse JSON: "+b}}return a}var c={};return c.applyTMXPropertiesFromXML=function(c,d){var e=d.getElementsByTagName(b.TMX_TAG_PROPERTIES)[0];if(e)for(var f=e.getElementsByTagName(b.TMX_TAG_PROPERTY),g=0;g<f.length;g++){var h=b.mapReader.TMXParser.getStringAttribute(f[g],b.TMX_TAG_NAME),i=b.mapReader.TMXParser.getStringAttribute(f[g],b.TMX_TAG_VALUE);c[h]=a(i)}},c.applyTMXPropertiesFromJSON=function(c,d){var e=d[b.TMX_TAG_PROPERTIES];if(e)for(var f in e)e.hasOwnProperty(f)&&(c[f]=a(e[f]))},c.mergeProperties=function(a,b,c){for(var d in b)(c||void 0===a[d])&&(a[d]=b[d]);return a},c}()}(window),function(){b.TMXOBjectGroup=Object.extend({initFromXML:function(a,c,d,e){this.name=a,this.width=b.mapReader.TMXParser.getIntAttribute(c,b.TMX_TAG_WIDTH),this.height=b.mapReader.TMXParser.getIntAttribute(c,b.TMX_TAG_HEIGHT),this.visible=1==b.mapReader.TMXParser.getIntAttribute(c,b.TMX_TAG_VISIBLE,1),this.z=e,this.objects=[],c.firstChild&&c.firstChild.nextSibling.nodeName===b.TMX_TAG_PROPERTIES&&b.TMXUtils.applyTMXPropertiesFromXML(this,c);for(var f=c.getElementsByTagName(b.TMX_TAG_OBJECT),g=0;g<f.length;g++){var h=new b.TMXOBject;h.initFromXML(f[g],d,e),this.objects.push(h)}},initFromJSON:function(a,c,d,e){var f=this;this.name=a,this.width=c[b.TMX_TAG_WIDTH],this.height=c[b.TMX_TAG_HEIGHT],this.visible=c[b.TMX_TAG_VISIBLE],this.z=e,this.objects=[],b.TMXUtils.applyTMXPropertiesFromJSON(this,c),c.objects.forEach(function(a){var c=new b.TMXOBject;c.initFromJSON(a,d,e),f.objects.push(c)})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}}),b.TMXOBject=Object.extend({initFromXML:function(a,c,d){if(this.name=b.mapReader.TMXParser.getStringAttribute(a,b.TMX_TAG_NAME),this.x=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_X),this.y=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_Y),this.z=d,this.width=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_WIDTH,0),this.height=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_HEIGHT,0),this.gid=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_GID,null),this.gid)this.setImage(this.gid,c);else{var e=a.getElementsByTagName(b.TMX_TAG_POLYGON);if(this.isPolygon=!0,e.length||(e=a.getElementsByTagName(b.TMX_TAG_POLYLINE),this.isPolygon=!1),e.length){this.points=[];for(var f,g=b.mapReader.TMXParser.getStringAttribute(e[0],b.TMX_TAG_POINTS),h=g.split(" "),i=0;i<h.length;i++)f=h[i].split(","),this.points[i]=new b.Vector2d(+f[0],+f[1])}}b.game.renderer.adjustPosition(this),b.TMXUtils.applyTMXPropertiesFromXML(this,a)},initFromJSON:function(a,c,d){if(this.name=a[b.TMX_TAG_NAME],this.x=parseInt(a[b.TMX_TAG_X]),this.y=parseInt(a[b.TMX_TAG_Y]),this.z=parseInt(d),this.width=parseInt(a[b.TMX_TAG_WIDTH]||0),this.height=parseInt(a[b.TMX_TAG_HEIGHT]||0),this.gid=parseInt(a[b.TMX_TAG_GID])||null,this.gid)this.setImage(this.gid,c);
else{var e=a[b.TMX_TAG_POLYGON];if(this.isPolygon=void 0!==e,e||(e=a[b.TMX_TAG_POLYLINE],this.isPolygon=!1),e){this.points=[];var f=this,g=0;e.forEach(function(a){f.points[g++]=new b.Vector2d(parseInt(a.x),parseInt(a.y))})}}b.game.renderer.adjustPosition(this),b.TMXUtils.applyTMXPropertiesFromJSON(this,a)},setImage:function(a,c){var d=c.getTilesetByGid(this.gid);this.width=d.tilewidth,this.height=d.tileheight,this.spritewidth=this.width;var e=new b.Tile(this.x,this.y,d.tilewidth,d.tileheight,this.gid);this.image=d.getTileImage(e)},getObjectPropertyByName:function(a){return this[a]}})}(window),function(){var a=2147483648,c=1073741824,d=536870912;b.Tile=b.Rect.extend({tileId:null,init:function(e,f,g,h,i){this.parent(new b.Vector2d(e*g,f*h),g,h),this.col=e,this.row=f,this.tileId=i,this.flipX=0!==(this.tileId&a),this.flipY=0!==(this.tileId&c),this.flipAD=0!==(this.tileId&d),this.flipped=this.flipX||this.flipY||this.flipAD,this.tileId&=~(a|c|d)}}),b.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",TOPLADDER:"topladder",BREAKABLE:"breakable"},init:function(){this.TileProperties=[],this.tileXOffset=[],this.tileYOffset=[]},initFromXML:function(a){this.firstgid=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_FIRSTGID);var c=b.mapReader.TMXParser.getStringAttribute(a,b.TMX_TAG_SOURCE);if(c){if(c=b.utils.getBasename(c),a=b.loader.getTMX(c),!a)throw"melonJS:"+c+" TSX tileset not found";b.mapReader.TMXParser.parseFromString(a),a=b.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=b.mapReader.TMXParser.getStringAttribute(a,b.TMX_TAG_NAME),this.tilewidth=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_TILEWIDTH),this.tileheight=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_TILEHEIGHT),this.spacing=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_SPACING,0),this.margin=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_MARGIN,0),this.tileoffset=new b.Vector2d(0,0);var d=a.getElementsByTagName(b.TMX_TAG_TILEOFFSET);d.length>0&&(this.tileoffset.x=b.mapReader.TMXParser.getIntAttribute(d[0],b.TMX_TAG_X),this.tileoffset.y=b.mapReader.TMXParser.getIntAttribute(d[0],b.TMX_TAG_Y));for(var e=a.getElementsByTagName(b.TMX_TAG_TILE),f=0;f<e.length;f++){var g=b.mapReader.TMXParser.getIntAttribute(e[f],b.TMX_TAG_ID)+this.firstgid,h={};b.TMXUtils.applyTMXPropertiesFromXML(h,e[f]),this.setTileProperty(g,h)}var i=a.getElementsByTagName(b.TMX_TAG_IMAGE)[0].getAttribute(b.TMX_TAG_SOURCE),j=i?b.loader.getImage(b.utils.getBasename(i)):null;j||console.log("melonJS: '"+i+"' file for tileset '"+this.name+"' not found!");var k=a.getElementsByTagName(b.TMX_TAG_IMAGE)[0].getAttribute(b.TMX_TAG_TRANS);this.initFromImage(j,k)},initFromJSON:function(a){this.firstgid=a[b.TMX_TAG_FIRSTGID];var c=a[b.TMX_TAG_SOURCE];if(c){c=b.utils.getBasename(c);var a=b.loader.getTMX(c);if(!a)throw"melonJS:"+c+" TSX tileset not found"}this.name=a[b.TMX_TAG_NAME],this.tilewidth=parseInt(a[b.TMX_TAG_TILEWIDTH]),this.tileheight=parseInt(a[b.TMX_TAG_TILEHEIGHT]),this.spacing=parseInt(a[b.TMX_TAG_SPACING]||0),this.margin=parseInt(a[b.TMX_TAG_MARGIN]||0),this.tileoffset=new b.Vector2d(0,0);var d=a[b.TMX_TAG_TILEOFFSET];d&&(this.tileoffset.x=parseInt(d[b.TMX_TAG_X]),this.tileoffset.y=parseInt(d[b.TMX_TAG_Y]));var e=a.tileproperties;for(var f in e){var g={};b.TMXUtils.mergeProperties(g,e[f]),this.setTileProperty(parseInt(f)+this.firstgid,g)}var h=b.utils.getBasename(a[b.TMX_TAG_IMAGE]),i=h?b.loader.getImage(h):null;i||console.log("melonJS: '"+h+"' file for tileset '"+this.name+"' not found!");var j=a[b.TMX_TAG_TRANS]||null;this.initFromImage(i,j)},initFromImage:function(a,c){a&&(this.image=a,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))),this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0),null!==c&&this.image&&(this.image=b.video.applyRGBFilter(this.image,"transparent",c.toUpperCase()).canvas)},setTileProperty:function(a,b){b.isSolid=b.type?b.type.toLowerCase()===this.type.SOLID:!1,b.isPlatform=b.type?b.type.toLowerCase()===this.type.PLATFORM:!1,b.isLeftSlope=b.type?b.type.toLowerCase()===this.type.L_SLOPE:!1,b.isRightSlope=b.type?b.type.toLowerCase()===this.type.R_SLOPE:!1,b.isBreakable=b.type?b.type.toLowerCase()===this.type.BREAKABLE:!1,b.isLadder=b.type?b.type.toLowerCase()===this.type.LADDER:!1,b.isTopLadder=b.type?b.type.toLowerCase()===this.type.TOPLADDER:!1,b.isSlope=b.isLeftSlope||b.isRightSlope,b.isCollidable=!!b.type,this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var c=b.video.createCanvasSurface(this.tilewidth,this.tileheight);return this.drawTile(c,0,0,a),c.canvas},getTileProperties:function(a){return this.TileProperties[a]},isTileCollidable:function(a){return this.TileProperties[a].isCollidable},getTileOffsetX:function(a){return null==this.tileXOffset[a]&&(this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount)),this.tileXOffset[a]},getTileOffsetY:function(a){return null==this.tileYOffset[a]&&(this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*~~(a/this.hTileCount)),this.tileYOffset[a]},drawTile:function(a,b,c,d){if(d.flipped){var e=1,f=0,g=0,h=1,i=b,j=c;b=c=0,a.save(),d.flipAD&&(e=0,f=1,g=1,h=0,j+=this.tileheight-this.tilewidth),d.flipX&&(e=-e,g=-g,i+=d.flipAD?this.tileheight:this.tilewidth),d.flipY&&(f=-f,h=-h,j+=d.flipAD?this.tilewidth:this.tileheight),a.transform(e,f,g,h,i,j)}var k=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(k),this.getTileOffsetY(k),this.tilewidth,this.tileheight,b,c,this.tilewidth,this.tileheight),d.flipped&&a.restore()}}),b.TMXTilesetGroup=Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){for(var b=-1,c=0,d=this.tilesets.length;d>c;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid==this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(-1!=b)return this.tilesets[b];throw"no matching tileset found for gid "+a}})}(window),function(){b.TMXOrthogonalRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d},canRender:function(a){return"orthogonal"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,c){return new b.Vector2d(a/this.tilewidth,c/this.tileheight)},tileToPixelCoords:function(a,c){return new b.Vector2d(a*this.tilewidth,c*this.tileheight)},adjustPosition:function(a){"number"==typeof a.gid&&(a.y-=a.height)},drawTile:function(a,b,c,d,e){e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c,d){var e=this.pixelToTileCoords(c.x+d.pos.x,c.y+d.pos.y).floorSelf(),f=this.pixelToTileCoords(c.x+d.pos.x+d.width+this.tilewidth,c.y+d.pos.y+d.height+this.tileheight).ceilSelf();f.x=f.x>this.cols?this.cols:f.x,f.y=f.y>this.rows?this.rows:f.y;for(var g=e.y;g<f.y;g++)for(var h=e.x;h<f.x;h++){var i=b.layerData[h][g];i&&(b.tileset.contains(i.tileId)||(b.tileset=b.tilesets.getTilesetByGid(i.tileId)),this.drawTile(a,h,g,i,b.tileset))}}}),b.TMXIsometricRenderer=Object.extend({init:function(a,b,c,d){this.cols=a,this.rows=b,this.tilewidth=c,this.tileheight=d,this.hTilewidth=c/2,this.hTileheight=d/2,this.originX=this.rows*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&this.cols===a.cols&&this.rows===a.rows&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,c){a-=this.originX;var d=c/this.tileheight,e=a/this.tilewidth;return new b.Vector2d(d+e,d-e)},tileToPixelCoords:function(a,c){return new b.Vector2d((a-c)*this.hTilewidth+this.originX,(a+c)*this.hTileheight)},adjustPosition:function(a){var b=a.x/this.hTilewidth,c=a.y/this.tileheight,d=this.tileToPixelCoords(b,c);d.x-=a.width/2,d.y-=a.height,a.x=d.x,a.y=d.y},drawTile:function(a,b,c,d,e){e.drawTile(a,(this.cols-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c,d){var e=b.tileset,f=e.tileoffset,g=this.pixelToTileCoords(c.x+d.pos.x-e.tilewidth,c.y+d.pos.y-e.tileheight).floorSelf(),h=this.pixelToTileCoords(c.x+d.pos.x+d.width+e.tilewidth,c.y+d.pos.y+d.height+e.tileheight).ceilSelf(),i=this.tileToPixelCoords(h.x,h.y),j=this.tileToPixelCoords(g.x,g.y);j.x-=this.hTilewidth,j.y+=this.tileheight;var k=j.y-d.pos.y+c.y>this.hTileheight,l=d.pos.x+c.x-j.x<this.hTilewidth;k&&(l?(g.x--,j.x-=this.hTilewidth):(g.y--,j.x+=this.hTilewidth),j.y-=this.hTileheight);for(var m=k^l,n=g.clone(),o=j.y;o-this.tileheight<i.y;o+=this.hTileheight){n.setV(g);for(var p=j.x;p<i.x;p+=this.tilewidth){if(n.x>=0&&n.y>=0&&n.x<this.cols&&n.y<this.rows){var q=b.layerData[n.x][n.y];q&&(e.contains(q.tileId)||(e=b.tileset=b.tilesets.getTilesetByGid(q.tileId),f=e.tileoffset),e.drawTile(a,f.x+p,f.y+o-e.tileheight,q))}n.x++,n.y--}m?(g.y++,j.x-=this.hTilewidth,m=!1):(g.x++,j.x+=this.hTilewidth,m=!0)}}})}(window),function(){b.ColorLayer=b.Renderable.extend({init:function(a,c,d){this.name=a,this.color=b.utils.HexToRGB(c),this.z=d,this.opacity=1,this.floating=!0,this.parent(new b.Vector2d(0,0),b.game.viewport.width,b.game.viewport.height)},reset:function(){},getOpacity:function(){return this.opacity},setOpacity:function(a){"number"==typeof a&&(this.opacity=a.clamp(0,1))},update:function(){return!1},draw:function(a,b){var c=a.globalAlpha;a.globalAlpha=this.opacity,a.fillStyle=this.color,a.fillRect(b.left,b.top,b.width,b.height),a.globalAlpha=c}}),b.ImageLayer=b.Renderable.extend({ratio:1,init:function(a,c,d,e,f,g){if(this.name=a,this.image=e?b.loader.getImage(b.utils.getBasename(e)):null,!this.image)throw"melonJS: '"+e+"' file for Image Layer '"+this.name+"' not found!";this.imagewidth=this.image.width,this.imageheight=this.image.height,this.z=f,this.ratio=g||1,this.viewport=b.game.viewport,this.lastpos=this.viewport.pos.clone(),c=c?Math.min(this.viewport.width,c):this.viewport.width,d=d?Math.min(this.viewport.height,d):this.viewport.height,this.parent(new b.Vector2d(0,0),c,d),this.opacity=1,this.floating=!0,this._repeat="repeat",this.repeatX=!0,this.repeatY=!0,Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){switch(this._repeat=a,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}}}),this.anchorPoint.set(0,0)},reset:function(){this.image=null,this.lastpos=null,this.viewport=null},getOpacity:function(){return this.opacity},setOpacity:function(a){"number"==typeof a&&(this.opacity=a.clamp(0,1))},update:function(){if(0===this.ratio)return!1;var a=this.viewport.pos;return this.lastpos.equals(a)?!1:(this.pos.x+=(a.x-this.lastpos.x)*this.ratio%this.imagewidth,this.pos.x=(this.imagewidth+this.pos.x)%this.imagewidth,this.pos.y+=(a.y-this.lastpos.y)*this.ratio%this.imageheight,this.pos.y=(this.imageheight+this.pos.y)%this.imageheight,this.lastpos.setV(a),!0)},draw:function(a,b){if(a.save(),(0!==this.anchorPoint.y||0!==this.anchorPoint.x)&&a.translate(~~(this.anchorPoint.x*(this.viewport.width-this.imagewidth)),~~(this.anchorPoint.y*(this.viewport.height-this.imageheight))),a.globalAlpha=this.opacity,0===this.ratio){var c=Math.min(b.width,this.imagewidth),d=Math.min(b.height,this.imageheight);a.drawImage(this.image,b.left,b.top,c,d,b.left,b.top,c,d)}else for(var e=~~this.pos.x,f=~~this.pos.y,g=0,h=0,c=Math.min(this.imagewidth-e,this.width),d=Math.min(this.imageheight-f,this.height);;){do a.drawImage(this.image,e,f,c,d,g,h,c,d),f=0,h+=d,d=Math.min(this.imageheight,this.height-h);while(this.repeatY&&h<this.height);if(g+=c,!this.repeatX||g>=this.width)break;e=0,c=Math.min(this.imagewidth,this.width-g),f=~~this.pos.y,h=0,d=Math.min(this.imageheight-~~this.pos.y,this.height)}a.restore()}}),b.CollisionTiledLayer=b.Renderable.extend({init:function(a,c){this.parent(new b.Vector2d(0,0),a,c),this.isCollisionMap=!0},reset:function(){},checkCollision:function(a,b){var c=b.x<0?a.left+b.x:a.right+b.x,d=b.y<0?a.top+b.y:a.bottom+b.y,e={x:0,y:0,xprop:{},yprop:{}};return(0>=c||c>=this.width)&&(e.x=b.x),(0>=d||d>=this.height)&&(e.y=b.y),e}}),b.TMXLayer=b.Renderable.extend({layerData:null,init:function(a,c,d,e,f){this.tilewidth=a,this.tileheight=c,this.orientation=d,this.z=f,this.tilesets=e,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.parent(new b.Vector2d(0,0),0,0)},initFromXML:function(a){this.name=b.mapReader.TMXParser.getStringAttribute(a,b.TMX_TAG_NAME),this.visible=1==b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_VISIBLE,1),this.opacity=b.mapReader.TMXParser.getFloatAttribute(a,b.TMX_TAG_OPACITY,1).clamp(0,1),this.cols=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_WIDTH),this.rows=b.mapReader.TMXParser.getIntAttribute(a,b.TMX_TAG_HEIGHT),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,b.TMXUtils.applyTMXPropertiesFromXML(this,a),void 0===this.preRender&&(this.preRender=b.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(b.COLLISION_LAYER),this.isCollisionMap&&!b.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=b.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),b.video.setImageSmoothing(this.layerSurface,b.sys.scalingInterpolation),this.layerSurface.globalAlpha=this.opacity)},initFromJSON:function(a){this.name=a[b.TMX_TAG_NAME],this.visible=a[b.TMX_TAG_VISIBLE],this.opacity=parseFloat(a[b.TMX_TAG_OPACITY]).clamp(0,1),this.cols=parseInt(a[b.TMX_TAG_WIDTH]),this.rows=parseInt(a[b.TMX_TAG_HEIGHT]),this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight,b.TMXUtils.applyTMXPropertiesFromJSON(this,a),void 0===this.preRender&&(this.preRender=b.sys.preRender),this.isCollisionMap=this.name.toLowerCase().contains(b.COLLISION_LAYER),this.isCollisionMap&&!b.debug.renderCollisionMap&&(this.visible=!1),this.preRender&&(this.layerCanvas=b.video.createCanvas(this.cols*this.tilewidth,this.rows*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),b.video.setImageSmoothing(this.layerSurface,b.sys.scalingInterpolation),this.layerSurface.globalAlpha=this.opacity)},reset:function(){this.preRender&&(this.layerCanvas=null,this.layerSurface=null),this.renderer=null,this.layerData=null,this.tileset=null,this.tilesets=null},setRenderer:function(a){this.renderer=a},initArray:function(a,b){this.layerData=[];for(var c=0;a>c;c++){this.layerData[c]=[];for(var d=0;b>d;d++)this.layerData[c][d]=null}},getTileId:function(a,b){var c=this.getTile(a,b);return c?c.tileId:null},getTile:function(a,b){return this.layerData[~~(a/this.tilewidth)][~~(b/this.tileheight)]},setTile:function(a,c,d){this.layerData[a][c]=new b.Tile(a,c,this.tilewidth,this.tileheight,d)},clearTile:function(a,b){this.layerData[a][b]=null,this.visible&&this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},getOpacity:function(){return this.opacity},setOpacity:function(a){"number"==typeof a&&(this.opacity=a.clamp(0,1),this.preRender&&(this.layerSurface.globalAlpha=this.opacity))},checkCollision:function(a,b){var c=b.x<0?~~(a.left+b.x):Math.ceil(a.right-1+b.x),d=b.y<0?~~(a.top+b.y):Math.ceil(a.bottom-1+b.y),e={x:0,xtile:void 0,xprop:{},y:0,ytile:void 0,yprop:{}};return 0>=c||c>=this.width?e.x=b.x:0!=b.x&&(e.xtile=this.getTile(c,Math.ceil(a.bottom-1)),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)?(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)):(e.xtile=this.getTile(c,~~a.top),e.xtile&&this.tileset.isTileCollidable(e.xtile.tileId)&&(e.x=b.x,e.xprop=this.tileset.getTileProperties(e.xtile.tileId)))),e.ytile=this.getTile(b.x<0?~~a.left:Math.ceil(a.right-1),d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)?(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId)):(e.ytile=this.getTile(b.x<0?Math.ceil(a.right-1):~~a.left,d),e.ytile&&this.tileset.isTileCollidable(e.ytile.tileId)&&(e.y=b.y||1,e.yprop=this.tileset.getTileProperties(e.ytile.tileId))),e},update:function(){return!1},draw:function(a,c){var d=b.game.viewport.pos;if(this.preRender){var e=Math.min(c.width,this.width),f=Math.min(c.height,this.height);a.drawImage(this.layerCanvas,d.x+c.pos.x,d.y+c.pos.y,e,f,d.x+c.pos.x,d.y+c.pos.y,e,f)}else{var g=a.globalAlpha;a.globalAlpha=this.opacity,this.renderer.drawTileLayer(a,this,d,c),a.globalAlpha=g}}})}(window),function(){b.TMXTileMap=b.Renderable.extend({init:function(a){this.levelId=a,this.z=0,this.name=null,this.cols=0,this.rows=0,this.tilewidth=0,this.tileheight=0,this.tilesets=null,this.mapLayers=[],this.objectGroups=[],this.initialized=!1,this.version="",this.orientation="",this.tilesets=null,this.parent(new b.Vector2d,0,0)},reset:function(){if(this.initialized===!0){for(var a=this.mapLayers.length;a--;)this.mapLayers[a].reset(),this.mapLayers[a]=null;for(var a=this.objectGroups.length;a--;)this.objectGroups[a].reset(),this.objectGroups[a]=null;this.tilesets=null,this.mapLayers.length=0,this.objectGroups.length=0,this.pos.set(0,0),this.initialized=!1}},getObjectGroupByName:function(a){var b=null;a=a.trim().toLowerCase();for(var c=this.objectGroups.length;c--;)if(this.objectGroups[c].name.toLowerCase().contains(a)){b=this.objectGroups[c];break}return b},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){var c=null;a=a.trim().toLowerCase();for(var d=this.mapLayers.length;d--;)if(this.mapLayers[d].name.toLowerCase().contains(a)){c=this.mapLayers[d];break}return a.toLowerCase().contains(b.COLLISION_LAYER)&&null==c&&(c=new b.CollisionTiledLayer(b.game.currentLevel.width,b.game.currentLevel.height)),c},clearTile:function(a,c){for(var d=this.mapLayers.length;d--;)this.mapLayers[d]instanceof b.TMXLayer&&this.mapLayers[d].clearTile(a,c)}})}(window),function(){function a(){var a={tmxDoc:null,setData:function(a){this.tmxDoc=a},getFirstElementByTagName:function(a){return this.tmxDoc?this.tmxDoc.getElementsByTagName(a)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(a,b,c){var d=a.getAttribute(b);return d?d.trim():c},getIntAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseInt(d):c},getFloatAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?parseFloat(d):c},getBooleanAttribute:function(a,b,c){var d=this.getStringAttribute(a,b,c);return d?"true"==d:c},free:function(){this.tmxDoc=null}};return a}b.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(a){if(!a.initialized){if("xml"===b.loader.getTMXFormat(a.levelId)?(null===this.XMLReader&&(this.XMLReader=new c),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(a,b.loader.getTMX(a.levelId))):(null===this.JSONReader&&(this.JSONReader=new d),this.JSONReader.readJSONMap(a,b.loader.getTMX(a.levelId))),a.width<b.game.viewport.width||a.height<b.game.viewport.height){var e=~~((b.game.viewport.width-a.width)/2),f=~~((b.game.viewport.height-a.height)/2);a.pos.add({x:e>0?e:0,y:f>0?f:0})}a.initialized=!0}},getNewDefaultRenderer:function(a){switch(a.orientation){case"orthogonal":return new b.TMXOrthogonalRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);case"isometric":return new b.TMXIsometricRenderer(a.cols,a.rows,a.tilewidth,a.tileheight);default:throw"melonJS: "+a.orientation+" type TMX Tile Map not supported!"}},setLayerData:function(a,c,d,e){switch(a.initArray(a.cols,a.rows),d){case null:var c=c.getElementsByTagName(b.TMX_TAG_TILE);break;case"json":break;case b.TMX_TAG_CSV:case b.TMX_TAG_ATTR_BASE64:for(var f="",g=0,h=c.childNodes.length;h>g;g++)f+=c.childNodes[g].nodeValue;if(d==b.TMX_TAG_CSV)var c=b.utils.decodeCSV(f,a.cols);else{var c=b.utils.decodeBase64AsArray(f,4);null!==e&&(c=b.utils.decompress(c,e))}f=null;break;default:throw"melonJS: TMX Tile Map "+d+" encoding not supported!"}for(var i=0,j=0;j<a.rows;j++)for(var k=0;k<a.cols;k++){var l=null==d?this.TMXParser.getIntAttribute(c[i++],b.TMX_TAG_GID):c[i++];if(0!==l){var m=new b.Tile(k,j,a.tilewidth,a.tileheight,l);a.layerData[k][j]=m,a.tileset.contains(m.tileId)||(a.tileset=a.tilesets.getTilesetByGid(m.tileId)),a.visible&&a.preRender&&a.renderer.drawTile(a.layerSurface,k,j,m,a.tileset)}}}});var c=b.TMXMapReader.extend({TMXParser:null,init:function(){this.TMXParser||(this.TMXParser=new a)},readXMLMap:function(a,c){if(!c)throw"melonJS:"+a.levelId+" TMX map not found";var d=0;this.TMXParser.setData(c);for(var e=this.TMXParser.getAllTagElements(),f=0;f<e.length;f++)switch(e.item(f).nodeName){case b.TMX_TAG_MAP:var g=e.item(f);a.version=this.TMXParser.getStringAttribute(g,b.TMX_TAG_VERSION),a.orientation=this.TMXParser.getStringAttribute(g,b.TMX_TAG_ORIENTATION),a.cols=this.TMXParser.getIntAttribute(g,b.TMX_TAG_WIDTH),a.rows=this.TMXParser.getIntAttribute(g,b.TMX_TAG_HEIGHT),a.tilewidth=this.TMXParser.getIntAttribute(g,b.TMX_TAG_TILEWIDTH),a.tileheight=this.TMXParser.getIntAttribute(g,b.TMX_TAG_TILEHEIGHT),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=this.TMXParser.getStringAttribute(g,b.TMX_BACKGROUND_COLOR),a.z=d++,b.TMXUtils.applyTMXPropertiesFromXML(a,g),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new b.ColorLayer("background_color",a.background_color,d++)),a.background_image&&a.mapLayers.push(new b.ImageLayer("background_image",a.width,a.height,a.background_image,d++)),null!==b.game.renderer&&b.game.renderer.canRender(a)||(b.game.renderer=this.getNewDefaultRenderer(a));break;case b.TMX_TAG_TILESET:a.tilesets||(a.tilesets=new b.TMXTilesetGroup),a.tilesets.add(this.readTileset(e.item(f)));break;case b.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(this.readImageLayer(a,e.item(f),d++));break;case b.TMX_TAG_LAYER:a.mapLayers.push(this.readLayer(a,e.item(f),d++));break;case b.TMX_TAG_OBJECTGROUP:a.objectGroups.push(this.readObjectGroup(a,e.item(f),d++))}this.TMXParser.free()},readLayer:function(a,c,d){var e=new b.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,d);e.initFromXML(c);var f=c.getElementsByTagName(b.TMX_TAG_DATA)[0],g=this.TMXParser.getStringAttribute(f,b.TMX_TAG_ENCODING,null),h=this.TMXParser.getStringAttribute(f,b.TMX_TAG_COMPRESSION,null);return""==g&&(g=null),""==h&&(h=null),(!e.isCollisionMap||b.debug.renderCollisionMap)&&(b.game.renderer.canRender(e)?e.setRenderer(b.game.renderer):e.setRenderer(b.mapReader.getNewDefaultRenderer(e))),this.setLayerData(e,f,g,h),f=null,e},readImageLayer:function(a,c,d){var e=this.TMXParser.getStringAttribute(c,b.TMX_TAG_NAME),f=this.TMXParser.getIntAttribute(c,b.TMX_TAG_WIDTH),g=this.TMXParser.getIntAttribute(c,b.TMX_TAG_HEIGHT),h=c.getElementsByTagName(b.TMX_TAG_IMAGE)[0].getAttribute(b.TMX_TAG_SOURCE),i=new b.ImageLayer(e,f*a.tilewidth,g*a.tileheight,h,d);return i.visible=1==this.TMXParser.getIntAttribute(c,b.TMX_TAG_VISIBLE,1),i.opacity=this.TMXParser.getFloatAttribute(c,b.TMX_TAG_OPACITY,1),b.TMXUtils.applyTMXPropertiesFromXML(i,c),i},readTileset:function(a){var c=new b.TMXTileset;return c.initFromXML(a),c},readObjectGroup:function(a,c,d){var e=this.TMXParser.getStringAttribute(c,b.TMX_TAG_NAME),f=new b.TMXOBjectGroup;return f.initFromXML(e,c,a.tilesets,d),f}}),d=b.TMXMapReader.extend({readJSONMap:function(a,c){if(!c)throw"melonJS:"+a.levelId+" TMX map not found";var d=0,e=this;a.version=c[b.TMX_TAG_VERSION],a.orientation=c[b.TMX_TAG_ORIENTATION],a.cols=parseInt(c[b.TMX_TAG_WIDTH]),a.rows=parseInt(c[b.TMX_TAG_HEIGHT]),a.tilewidth=parseInt(c[b.TMX_TAG_TILEWIDTH]),a.tileheight=parseInt(c[b.TMX_TAG_TILEHEIGHT]),a.width=a.cols*a.tilewidth,a.height=a.rows*a.tileheight,a.backgroundcolor=c[b.TMX_BACKGROUND_COLOR],a.z=d++,b.TMXUtils.applyTMXPropertiesFromJSON(a,c),a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color,a.background_color&&a.mapLayers.push(new b.ColorLayer("background_color",a.background_color,d++)),a.background_image&&a.mapLayers.push(new b.ImageLayer("background_image",a.width,a.height,a.background_image,d++)),null!==b.game.renderer&&b.game.renderer.canRender(a)||(b.game.renderer=this.getNewDefaultRenderer(a)),a.tilesets||(a.tilesets=new b.TMXTilesetGroup),c.tilesets.forEach(function(b){a.tilesets.add(e.readTileset(b))}),c.layers.forEach(function(c){switch(c.type){case b.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(e.readImageLayer(a,c,d++));break;case b.TMX_TAG_TILE_LAYER:a.mapLayers.push(e.readLayer(a,c,d++));break;case b.TMX_TAG_OBJECTGROUP:a.objectGroups.push(e.readObjectGroup(a,c,d++))}})},readLayer:function(a,c,d){var e=new b.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,d);return e.initFromJSON(c),e.isCollisionMap||(b.game.renderer.canRender(e)?e.setRenderer(b.game.renderer):e.setRenderer(b.mapReader.getNewDefaultRenderer(e))),this.setLayerData(e,c[b.TMX_TAG_DATA],"json",null),e},readImageLayer:function(a,c,d){var e=c[b.TMX_TAG_NAME],f=parseInt(c[b.TMX_TAG_WIDTH]),g=parseInt(c[b.TMX_TAG_HEIGHT]),h=c[b.TMX_TAG_IMAGE],i=new b.ImageLayer(e,f*a.tilewidth,g*a.tileheight,h,d);return i.visible=c[b.TMX_TAG_VISIBLE],i.opacity=parseFloat(c[b.TMX_TAG_OPACITY]),b.TMXUtils.applyTMXPropertiesFromJSON(i,c),i.ratio=parseFloat(i.ratio),i},readTileset:function(a){var c=new b.TMXTileset;return c.initFromJSON(a),c},readObjectGroup:function(a,c,d){var e=new b.TMXOBjectGroup;return e.initFromJSON(c[b.TMX_TAG_NAME],c,a.tilesets,d),e}})}(window),function(){b.levelDirector=function(){var a={},c={},d=[],e=0;return a.reset=function(){},a.addLevel=function(){throw"melonJS: no level loader defined"},a.addTMXLevel=function(a,e){return null!=c[a]?!1:(c[a]=new b.TMXTileMap(a),c[a].name=a,d.push(a),e&&e(),!0)},a.loadLevel=function(f){if(f=f.toString().toLowerCase(),void 0===c[f])throw"melonJS: level "+f+" not found";if(!(c[f]instanceof b.TMXTileMap))throw"melonJS: no level loader defined";var g=b.state.isRunning();return g&&b.state.pause(),b.game.reset(),b.utils.resetGUID(f),c[a.getCurrentLevelId()]&&c[a.getCurrentLevelId()].reset(),b.mapReader.readMap(c[f]),e=d.indexOf(f),b.game.loadTMXLevel(c[f]),g&&b.state.resume(),!0},a.getCurrentLevelId=function(){return d[e]},a.reloadLevel=function(){return a.loadLevel(a.getCurrentLevelId())},a.nextLevel=function(){return e+1<d.length?a.loadLevel(d[e+1]):!1},a.previousLevel=function(){return e-1>=0?a.loadLevel(d[e-1]):!1},a.levelCount=function(){return d.length},a}()}(window),/**
 * @preserve Tween JS
 * https://github.com/sole/Tween.js
 */
function(){b.Tween=function(a){var c=a,d={},e={},f={},g=1e3,h=0,i=null,j=0,k=b.Tween.Easing.Linear.EaseNone,l=null,m=null,n=null;this.alwaysUpdate=!0,this.to=function(a,b){void 0!==b&&(g=b);for(var d in a)null!==c[d]&&(f[d]=a[d]);return this},this.start=function(){b.game.add(this,999),i=b.timer.getTime()+h,j=0;for(var a in f)null!==c[a]&&(d[a]=c[a],e[a]=f[a]-c[a]);return this},this.stop=function(){return b.game.remove(this,!0),this},this.delay=function(a){return h=a,this},b.event.subscribe(b.event.STATE_PAUSE,function(){i&&(j=b.timer.getTime())}),b.event.subscribe(b.event.STATE_RESUME,function(){i&&j&&(i+=b.timer.getTime()-j)}),this.easing=function(a){return k=a,this},this.chain=function(a){return l=a,this},this.onUpdate=function(a){return m=a,this},this.onComplete=function(a){return n=a,this},this.update=function(){var a,f,h,j=b.timer.getTime();if(i>j)return!0;(f=(j-i)/g)>=1&&(f=1),h=k(f);for(a in e)c[a]=d[a]+e[a]*h;return null!==m&&m.call(c,h),1===f?(b.game.remove(this,!0),null!==n&&n.call(c),null!==l&&l.start(),!1):!0}},b.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},b.Tween.Easing.Linear.EaseNone=function(a){return a},b.Tween.Easing.Quadratic.EaseIn=function(a){return a*a},b.Tween.Easing.Quadratic.EaseOut=function(a){return a*(2-a)},b.Tween.Easing.Quadratic.EaseInOut=function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)},b.Tween.Easing.Cubic.EaseIn=function(a){return a*a*a},b.Tween.Easing.Cubic.EaseOut=function(a){return--a*a*a+1},b.Tween.Easing.Cubic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},b.Tween.Easing.Quartic.EaseIn=function(a){return a*a*a*a},b.Tween.Easing.Quartic.EaseOut=function(a){return 1- --a*a*a*a},b.Tween.Easing.Quartic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},b.Tween.Easing.Quintic.EaseIn=function(a){return a*a*a*a*a},b.Tween.Easing.Quintic.EaseOut=function(a){return--a*a*a*a*a+1},b.Tween.Easing.Quintic.EaseInOut=function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},b.Tween.Easing.Sinusoidal.EaseIn=function(a){return 1-Math.cos(a*Math.PI/2)},b.Tween.Easing.Sinusoidal.EaseOut=function(a){return Math.sin(a*Math.PI/2)},b.Tween.Easing.Sinusoidal.EaseInOut=function(a){return.5*(1-Math.cos(Math.PI*a))},b.Tween.Easing.Exponential.EaseIn=function(a){return 0===a?0:Math.pow(1024,a-1)},b.Tween.Easing.Exponential.EaseOut=function(a){return 1===a?1:1-Math.pow(2,-10*a)},b.Tween.Easing.Exponential.EaseInOut=function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)},b.Tween.Easing.Circular.EaseIn=function(a){return 1-Math.sqrt(1-a*a)},b.Tween.Easing.Circular.EaseOut=function(a){return Math.sqrt(1- --a*a)},b.Tween.Easing.Circular.EaseInOut=function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},b.Tween.Easing.Elastic.EaseIn=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)))},b.Tween.Easing.Elastic.EaseOut=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/d)+1)},b.Tween.Easing.Elastic.EaseInOut=function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d):.5*c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)+1)},b.Tween.Easing.Back.EaseIn=function(a){var b=1.70158;return a*a*((b+1)*a-b)},b.Tween.Easing.Back.EaseOut=function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},b.Tween.Easing.Back.EaseInOut=function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)},b.Tween.Easing.Bounce.EaseIn=function(a){return 1-b.Tween.Easing.Bounce.EaseOut(1-a)},b.Tween.Easing.Bounce.EaseOut=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},b.Tween.Easing.Bounce.EaseInOut=function(a){return.5>a?.5*b.Tween.Easing.Bounce.EaseIn(2*a):.5*b.Tween.Easing.Bounce.EaseOut(2*a-1)+.5}}(),/**
 * @preserve MinPubSub
 * a micro publish/subscribe messaging framework
 * @see https://github.com/daniellmb/MinPubSub 
 * @author Daniel Lamb <daniellmb.com>
 *
 * Released under the MIT License
 */
function(){b.event=function(){var a={},b={};return a.STATE_PAUSE="me.state.onPause",a.STATE_RESUME="me.state.onResume",a.GAME_INIT="me.game.onInit",a.LEVEL_LOADED="me.game.onLevelLoaded",a.LOADER_COMPLETE="me.loader.onload",a.LOADER_PROGRESS="me.loader.onProgress",a.KEYDOWN="me.input.keydown",a.KEYUP="me.input.keyup",a.WINDOW_ONRESIZE="window.onresize",a.publish=function(a,c){for(var d=b[a],e=d?d.length:0;e--;)d[e].apply(window,c||[])},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(a,c){for(var d=b[c?a:a[0]],c=c||a[1],e=d?d.length:0;e--;)d[e]===c&&d.splice(e,1)},a}()}(),function(){b.plugin=function(){var a={};return a.Base=Object.extend({version:void 0,init:function(){}}),a.patch=function(a,b,c){if(void 0!==a.prototype)var a=a.prototype;if("function"==typeof a[b]){var d=a[b];a[b]=function(a,b){return function(){var a=this.parent;this.parent=d;var c=b.apply(this,arguments);return this.parent=a,c}}(b,c)}else console.error(b+" is not an existing function")},a.register=function(a,c){if(b.plugin[c]&&console.error("plugin "+c+" already registered"),void 0===a.prototype.version)throw"melonJS: Plugin version not defined !";if(b.sys.checkVersion(a.prototype.version)>0)throw"melonJS: Plugin version mismatch, expected: "+a.prototype.version+", got: "+b.version;var d=[];if(arguments.length>2&&(d=Array.prototype.slice.call(arguments,1)),d[0]=a,b.plugin[c]=new(a.bind.apply(a,d)),!(b.plugin[c]instanceof b.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !"},a}()}(),a(window),b});